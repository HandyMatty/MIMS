import{a8 as U,r,u as X,a9 as u,j as t,n as ee,w as R,k,a as te,C as S,aa as E,M as ae,B as ne,ab as se}from"./index-Cq9w5H2m.js";import{L as _}from"./index-TEJeC4Bg.js";import{A as $,C as re}from"./index-DgLzbIEw.js";var D={exports:{}},oe=D.exports,q;function le(){return q||(q=1,function(v,F){(function(M,y){v.exports=y(U())})(oe,function(M){function y(d){return d&&typeof d=="object"&&"default"in d?d:{default:d}}var L=y(M),j={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(d,m){return m==="W"?d+"周":d+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(d,m){var h=100*d+m;return h<600?"凌晨":h<900?"早上":h<1100?"上午":h<1300?"中午":h<1800?"下午":"晚上"}};return L.default.locale(j,null,!0),j})}(D)),D.exports}le();u.extend(se);const ue=({eventsData:v,loading:F})=>{const[M,y]=r.useState(!1),[L,j]=r.useState(null),[d,m]=r.useState([]),[h,T]=r.useState({}),[w,C]=r.useState(null),[B,Y]=r.useState(null),[p,G]=r.useState("month"),{theme:o,currentTheme:b}=X(),c=r.useMemo(()=>v||[],[v]),N=r.useCallback(e=>{const a=c.filter(s=>s.event_date===e.format("YYYY-MM-DD"));m(a)},[c]),g=r.useCallback((e,a)=>{const s=c.filter(n=>{const l=u(n.event_date);return l.month()===e&&l.year()===a});m(s)},[c]),z=r.useCallback(e=>{const a=c.filter(s=>u(s.event_date).year()===e);m(a)},[c]),A=r.useCallback(e=>{const a=c.filter(n=>u(n.event_date).year()===e),s=a.reduce((n,l)=>{const f=u(l.event_date).month();return n[f]||(n[f]=[]),n[f].push(l),n},{});T(s),m(a)},[c]),V=r.useCallback(e=>{N(e),j(e);const a=e.year(),s=e.month();Y(a),C(s);const n=c.some(l=>l.event_date===e.format("YYYY-MM-DD"));y(n)},[N,c]),H=r.useCallback((e,a)=>{C(e),Y(a),g(e,a);const s=c.some(n=>{const l=u(n.event_date);return l.month()===e&&l.year()===a});y(s)},[g,c]),I=r.useCallback(e=>{Y(e),C(null),A(e),y(!0)},[A]),O=r.useCallback(()=>{y(!1),m([]),T({})},[]),Z=r.useCallback(e=>{const a=e.format("YYYY-MM-DD"),s=c.filter(n=>n.event_date===a);if(s.length>0){const n=s.map(l=>l.content).join(", ");return t.jsx(ee,{title:n,placement:"top",children:t.jsx("div",{className:"w-1.5 h-1.5 rounded-full mx-auto my-1",style:{backgroundColor:b!=="default"?o.primary||o.text:"#15803d"}})})}return null},[c,b,o]),K=r.useCallback((e,a)=>{const s=e.month(),n=e.year();a==="month"&&p==="month"?(C(s),Y(n),g(s,n)):a==="year"&&p==="year"&&(Y(n),z(n))},[p,g,z]),P=r.useMemo(()=>Object.keys(h).map(e=>t.jsxs("div",{children:[t.jsx(R.Title,{level:5,children:u().month(e).format("MMMM")}),t.jsx(_,{itemLayout:"horizontal",dataSource:h[e],renderItem:a=>t.jsx(_.Item,{children:t.jsx(_.Item.Meta,{avatar:t.jsx($,{src:a.avatar}),title:a.username,description:t.jsx("span",{style:{color:a.event_type},children:a.content})})},a.id)})]},e)),[h]),W=r.useMemo(()=>({...b!=="default"&&{"--calendar-bg":o.componentBackground,"--calendar-text":o.text,"--calendar-border":o.border,"--calendar-radio-checked-bg":o.primary||o.text,"--calendar-cell-hover-bg":o.primary?`${o.primary}33`:`${o.text}33`,"--calendar-selected-bg":o.primary||o.textLight,"--calendar-selected-text":o.componentBackground,"--calendar-today-bg":o.primary?o.primary:o.textLight,"--calendar-today-text":o.componentBackground,background:o.componentBackground}}),[b,o]),J=r.useCallback(({value:e,onChange:a})=>{const s=e.year(),n=e.month(),l=e.localeData(),f=Array.from({length:12},(x,i)=>t.jsx(k.Option,{value:i,children:l.monthsShort(u().month(i))},i)),Q=Array.from({length:20},(x,i)=>t.jsx(k.Option,{value:s-10+i,children:s-10+i},s-10+i));return t.jsxs("div",{className:"p-1",children:[t.jsx(R.Title,{level:4,children:"Calendar"}),t.jsxs(te,{gutter:8,children:[t.jsx(S,{children:t.jsxs(E.Group,{size:"small",onChange:x=>G(x.target.value),value:p,children:[t.jsx(E.Button,{className:"text-black text-xs",value:"month",children:"Month"}),t.jsx(E.Button,{className:"text-black text-xs",value:"year",children:"Year"})]})}),t.jsx(S,{children:t.jsx(k,{size:"small",value:s,onChange:x=>{const i=e.clone().year(x);a(i),p==="year"&&I(x)},className:"w-auto",children:Q})}),p==="month"&&t.jsx(S,{children:t.jsx(k,{size:"small",value:n,onChange:x=>{const i=e.clone().month(x);a(i),H(x,s)},className:"w-auto",children:f})})]})]})},[p,I,H]);return t.jsxs("div",{className:"max-w-full h-auto rounded-xl bg-[#5fe7a7] shadow-md calendar-container calendar-card-head",style:W,children:[t.jsx(re,{fullscreen:!1,className:"bg-transparent",onSelect:V,cellRender:Z,headerRender:J,onPanelChange:K}),t.jsx(ae,{title:p==="year"?`Events in ${B||u().year()}`:`Events in ${w!==null?u().month(w).year(B).format("MMMM YYYY"):"Select Month"}`,open:M,onCancel:O,footer:[t.jsx(ne,{onClick:O,className:"custom-button-cancel",children:"Close"},"close")],children:p==="year"?P:d.length>0&&t.jsx(_,{itemLayout:"horizontal",dataSource:d,renderItem:e=>t.jsx(_.Item,{children:t.jsx(_.Item.Meta,{avatar:t.jsx($,{src:e.avatar}),title:e.username,description:t.jsx("span",{style:{color:e.event_type},children:e.content})})},e.id)})})]})};export{ue as default};
