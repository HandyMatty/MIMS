import{j as e,ak as ue,r as a,q as me,B as V,bb as fe,I as pe,R as he,i as H,al as be,m as ge}from"./index-D_DjqwU6.js";import{Q as je}from"./QrCodeModal-92HbiXnI.js";import{H as c}from"./HighlightText-BHuCeSLK.js";import{T as K}from"./index-BlUNoHI2.js";import{d as ye}from"./debounce-BtCwp3QT.js";import{u as we,F as ke}from"./index-GL6TR608.js";import{i as Ce,g as ve,u as z,m as Ne,S as Se}from"./cacheUtils-rgXBj3X0.js";import{getInventoryData as _}from"./addItemToInventory-Bv13ONqm.js";import{i as $}from"./offlineUtils-CjPJFgFK.js";import{D as De,S as Ie}from"./index-CYk8aGXX.js";import{R as Re}from"./FilterOutlined-B9-Kq489.js";import{P as Me}from"./Pagination-B3MLnmFW.js";import"./qrCodeUtils-DyUbhdI5.js";import"./createForOfIteratorHelper-BG_wcgzh.js";import"./index-DG92omOn.js";import"./useBubbleLock-BNMpLRc-.js";import"./index-CRHxdFZf.js";const Oe=(i,l="")=>{let o;switch(i){case"On Stock":o="green";break;case"For Repair":o="volcano";break;case"Deployed":o="blue";break;default:o="gray"}return e.jsx(K,{color:o,className:"text-wrap text-center",children:e.jsx(c,{text:i,searchTerm:l})})},Qe=(i,l="")=>{let o;switch(i){case"Brand New":o="gold";break;case"Good Condition":o="green";break;case"Defective":o="red";break;default:o="gray"}return e.jsx(K,{color:o,className:"text-wrap text-center",children:e.jsx(c,{text:i,searchTerm:l})})},Be=(i,l="",o={},d={})=>[{title:"QR Code",dataIndex:"qrCode",key:"qrCode",align:"center",width:"70px",className:"text-xs overflow-auto",render:(s,r)=>e.jsx(ue,{style:{fontSize:"24px",cursor:"pointer"},onClick:()=>i(r),title:"Generate QR Code"})},{title:"ID",dataIndex:"id",key:"id",align:"center",fixed:"left",className:"text-xs",width:"120px",sorter:(s,r)=>Number(s.id)-Number(r.id),render:s=>e.jsx(c,{text:s,searchTerm:l})},{title:"Type",dataIndex:"type",key:"type",align:"center",className:"text-xs overflow-auto",responsive:["sm"],width:"120px",sorter:(s,r)=>s.type.localeCompare(r.type),render:s=>e.jsx(c,{text:s,searchTerm:l})},{title:"Brand",dataIndex:"brand",key:"brand",align:"center",className:"text-xs overflow-auto",width:"120px",responsive:["sm"],sorter:(s,r)=>s.brand.localeCompare(r.brand),render:s=>e.jsx(c,{text:s,searchTerm:l})},{title:"Qty",dataIndex:"quantity",key:"quantity",align:"center",className:"text-xs overflow-auto text-wrap",responsive:["sm"],width:"80px",sorter:(s,r)=>s.quantity-r.quantity,render:s=>e.jsx(c,{text:s,searchTerm:l})},{title:"Remarks",dataIndex:"remarks",key:"remarks",align:"center",className:"text-xs overflow-auto text-wrap",responsive:["sm"],width:"200px",render:s=>e.jsx(c,{text:s&&s.trim()!==""?s:"-",searchTerm:l})},{title:"Serial Number",dataIndex:"serialNumber",key:"serialNumber",align:"center",width:"170px",className:"text-xs overflow-auto text-wrap",responsive:["sm"],sorter:(s,r)=>s.serialNumber.localeCompare(r.serialNumber),render:s=>e.jsx(c,{text:s&&s.trim()!==""?s:"-",searchTerm:l})},{title:"Issued Date",dataIndex:"issuedDate",key:"issuedDate",align:"center",className:"text-xs overflow-auto",width:"110px",responsive:["sm"],sorter:(s,r)=>s.issuedDate.localeCompare(r.issuedDate),render:s=>!s||s==="0000-00-00"||s===""?e.jsx(c,{text:"NO DATE",searchTerm:l}):e.jsx(c,{text:s,searchTerm:l})},{title:"Purchased Date",dataIndex:"purchaseDate",key:"purchaseDate",align:"center",width:"110px",className:"text-xs overflow-auto",responsive:["sm"],sorter:(s,r)=>s.purchaseDate.localeCompare(r.purchaseDate),render:s=>!s||s==="0000-00-00"||s===""?e.jsx(c,{text:"NO DATE",searchTerm:l}):e.jsx(c,{text:s,searchTerm:l})},{title:"Condition",dataIndex:"condition",key:"condition",align:"center",width:"120px",className:"text-xs overflow-auto",responsive:["sm"],render:s=>Qe(s,l),filters:[{text:"Brand New",value:"Brand New"},{text:"Good Condition",value:"Good Condition"},{text:"Defective",value:"Defective"}],filteredValue:d.condition||null,onFilter:(s,r)=>r.condition===s},{title:"Detachment/Office",dataIndex:"location",key:"location",align:"center",width:"150px",className:"text-xs overflow-auto",responsive:["sm"],render:s=>e.jsx(c,{text:s,searchTerm:l})},{title:"Status",dataIndex:"status",key:"status",align:"center",width:"120px",className:"text-xs overflow-auto",responsive:["sm"],render:s=>Oe(s,l),filters:[{text:"On Stock",value:"On Stock"},{text:"For Repair",value:"For Repair"},{text:"Deployed",value:"Deployed"}],filteredValue:d.status||null,onFilter:(s,r)=>r.status===s}],{Option:G}=H,Te=()=>e.jsxs("div",{className:"w-full h-full mx-auto rounded-xl shadow border-none p-8 table-skeleton",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 mb-4 space-y-2 sm:space-y-0",children:[...Array(5)].map((i,l)=>e.jsx("div",{className:"h-8 bg-gray-300 rounded w-20 animate-pulse"},l))}),e.jsx("div",{className:"w-auto overflow-x-auto",children:e.jsxs("div",{className:"table-skeleton",children:[e.jsx("div",{className:"table-skeleton-row rounded mb-2 bg-gray-300 animate-pulse"}),[...Array(5)].map((i,l)=>e.jsx("div",{className:"table-skeleton-row rounded mb-2 bg-gray-300 animate-pulse"},l))]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-32 animate-pulse"}),e.jsx("div",{className:"h-8 bg-gray-300 rounded w-48 animate-pulse"})]})]}),Xe=({inventoryData:i=[],loading:l=!1,error:o=null,onRefresh:d,onItemSelect:s,lastSyncTime:r})=>{var q,L;const[w,W]=a.useState(""),[k,Y]=a.useState("Newest"),[f,C]=a.useState(1),[p,J]=a.useState(10),[U,S]=a.useState(!1),[v,N]=a.useState(null),[m,X]=a.useState("all"),[D,Z]=a.useState([]),[I,R]=a.useState(!1),[x,ee]=a.useState({}),[M,O]=a.useState(!1),Q=we({maxWidth:639}),h=a.useRef(null),g="qrcode";a.useEffect(()=>{i.length>0&&!v&&(s(i[0]),N(i[0]))},[i,v,s]);const j=a.useMemo(()=>[{key:"all",label:"All Columns"},{key:"id",label:"ID"},{key:"type",label:"Type"},{key:"brand",label:"Brand"},{key:"quantity",label:"Quantity"},{key:"remarks",label:"Remarks"},{key:"serialNumber",label:"Serial Number"},{key:"issuedDate",label:"Issued Date"},{key:"purchaseDate",label:"Purchase Date"},{key:"location",label:"Location"},{key:"status",label:"Status"},{key:"condition",label:"Condition"}],[]),B=a.useMemo(()=>ye(t=>{if(t===""){R(!1);return}R(!0);const n=i.filter(u=>{if(!u)return!1;if(m==="all"){for(const y in u){const P=u[y];if(P&&String(P).toLowerCase().includes(t.toLowerCase()))return!0}return!1}else{const y=u[m];return y&&String(y).toLowerCase().includes(t.toLowerCase())}});Z(n)},300),[i,m]),te=a.useCallback(t=>{const n=t.target.value;W(n),B(n)},[B]),se=a.useCallback(t=>{X(t)},[]),ae=a.useCallback(async(t=!1)=>{try{if(await $()){console.warn("Cannot refresh QR code data while offline");return}if(O(!0),Ce(g,t)){const u=ve(g);d&&d(u);return}const n=await _();z(g,n),d&&d(n)}catch(n){console.error("Failed to load QR code data:",n)}finally{O(!1)}},[d]),T=a.useCallback(()=>{h.current&&clearInterval(h.current),h.current=setInterval(async()=>{try{if(await $())return;const t=await _();z(g,t),d&&d(t)}catch(t){console.warn("Background sync failed:",t),Ne(g)}},Se)},[d]),A=a.useCallback(()=>{h.current&&(clearInterval(h.current),h.current=null)},[]);a.useEffect(()=>(T(),()=>A()),[T,A]);const le=a.useCallback(t=>{Y(t),C(1)},[]),re=a.useCallback((t,n)=>{C(t),J(n)},[]),ne=a.useCallback((t,n,u)=>{ee(n),C(1)},[]),E=a.useCallback(t=>{N(t),S(!0)},[]),ie=a.useCallback(t=>{s(t),N(t)},[s]),F=a.useMemo(()=>{let t=I?D:i;return x.condition&&x.condition.length>0&&(t=t.filter(n=>x.condition.includes(n.condition))),x.status&&x.status.length>0&&(t=t.filter(n=>x.status.includes(n.status))),t},[I,D,i,x]),b=a.useMemo(()=>{const t=[...F].sort((n,u)=>Number(n.id)-Number(u.id));return k==="Newest"?t.reverse():t},[F,k]),oe=a.useMemo(()=>j.map(t=>({key:t.key,label:t.label})),[j]),ce=a.useMemo(()=>b.slice((f-1)*p,f*p),[b,f,p]),de=a.useMemo(()=>Be(E,w,void 0,x),[E,w,x]),xe=a.useMemo(()=>Q?{expandedRowRender:t=>e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",t.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",t.type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Brand:"})," ",t.brand]}),e.jsxs("div",{children:[e.jsx("b",{children:"Quantity:"})," ",t.quantity]}),e.jsxs("div",{children:[e.jsx("b",{children:"Remarks:"})," ",t.remarks]}),e.jsxs("div",{children:[e.jsx("b",{children:"Serial Number:"})," ",t.serialNumber]}),e.jsxs("div",{children:[e.jsx("b",{children:"Issued Date:"})," ",t.issuedDate]}),e.jsxs("div",{children:[e.jsx("b",{children:"Purchased Date:"})," ",t.purchaseDate]}),e.jsxs("div",{children:[e.jsx("b",{children:"Condition:"})," ",t.condition]}),e.jsxs("div",{children:[e.jsx("b",{children:"Location:"})," ",t.location]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",t.status]})]}),rowExpandable:()=>!0}:void 0,[Q]);return l?e.jsx(Te,{}):e.jsxs(me,{title:e.jsx("span",{className:"text-lgi sm:text-sm md:text-base lg:text-lgi xl:text-xl font-bold flex justify-center",children:"ITEMS"}),className:"flex flex-col w-full mx-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 mb-4 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2 sm:mb-0",children:[e.jsx(De,{className:"theme-aware-dropdown-btn border border-black sm:block hidden",menu:{items:oe,onClick:({key:t})=>se(t),selectedKeys:[m]},trigger:["click"],children:e.jsx(V,{type:"text",size:"small",className:"text-xs",icon:e.jsx(Re,{}),children:e.jsxs(Ie,{className:"text-xs w-auto align-middle",children:[((q=j.find(t=>t.key===m))==null?void 0:q.label)||"All Columns",e.jsx(fe,{})]})})}),e.jsx(pe,{placeholder:`Search in ${m==="all"?"all columns":(L=j.find(t=>t.key===m))==null?void 0:L.label}`,prefix:e.jsx(he,{}),className:"border border-black w-auto ml-1 text-xs h-6",value:w,allowClear:!0,onChange:te})]}),e.jsxs("div",{className:"flex gap-2 w-auto justify-center ",children:[e.jsxs(H,{value:k,className:"w-auto text-xs transparent-select",size:"small",onChange:le,children:[e.jsx(G,{value:"Newest",children:e.jsx("span",{className:"text-xs",children:"Newest"})}),e.jsx(G,{value:"Oldest",children:e.jsx("span",{className:"text-xs",children:"Oldest"})})]}),e.jsx(V,{onClick:()=>ae(!0),className:"custom-button text-xs",type:"default",size:"small",icon:e.jsx(be,{}),loading:M,children:e.jsx("span",{className:"text-xs",children:M?"Refreshing...":"Refresh"})})]})]}),e.jsx(ke,{rowKey:"id",columns:de,dataSource:ce,pagination:!1,bordered:!0,sortDirections:["descend","ascend"],onChange:ne,onRow:t=>({onClick:()=>ie(t)}),scroll:{x:"max-content",y:600},responsive:["sm","md","lg","xl","xxl"],expandable:xe}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-5 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"w-full flex flex-col items-center sm:items-start",children:[e.jsxs(ge.Text,{style:{color:"#072C1C"},className:"w-full text-xs text-wrap text-center sm:text-left",children:["Showing data of ",b.length>0?(f-1)*p+1:0," to"," ",Math.min(f*p,b.length)," of ",b.length," entries"]}),r&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-center sm:text-left",children:["Last synced: ",new Date(r).toLocaleTimeString()]})]}),e.jsx("div",{className:"w-full flex justify-center sm:justify-end",children:e.jsx(Me,{current:f,pageSize:p,total:b.length,showSizeChanger:!0,pageSizeOptions:["10","20","30","50","100","200","500","1000","2000"],onChange:re,className:"text-xs",responsive:!0})})]}),e.jsx(je,{isVisible:U,onClose:()=>S(!1),qrDetails:v})]})};export{Xe as default};
