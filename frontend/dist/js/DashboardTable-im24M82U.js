import{j as e,ak as pe,r as a,u as be,d as ge,e as we,s as I,i as U,B as k,al as je,am as ye,m as ve}from"./index-D_DjqwU6.js";import{Q as Ce}from"./QrCodeModal-92HbiXnI.js";import{H as c}from"./HighlightText-BHuCeSLK.js";import{T as W}from"./index-BlUNoHI2.js";import{u as ke,F as Ne}from"./index-GL6TR608.js";import{h as T,B as De}from"./BatchPrintItemModal-DkVt5K-6.js";import{E as Se}from"./ExportModal-DlIubpvc.js";import{i as Ie,g as Be,u as $,m as Oe,S as Ee}from"./cacheUtils-rgXBj3X0.js";import{getInventoryData as G}from"./addItemToInventory-Bv13ONqm.js";import{i as K}from"./offlineUtils-CjPJFgFK.js";import{R as _}from"./PrinterOutlined-D-ModBVM.js";import{P as Me}from"./Pagination-B3MLnmFW.js";import"./qrCodeUtils-DyUbhdI5.js";import"./createForOfIteratorHelper-BG_wcgzh.js";import"./index-DG92omOn.js";import"./useBubbleLock-BNMpLRc-.js";import"./index-CYk8aGXX.js";import"./index-CRHxdFZf.js";const Re=(d,l="")=>{let t;switch(d){case"On Stock":t="green";break;case"For Repair":t="volcano";break;case"Deployed":t="blue";break;default:t="gray"}return e.jsx(W,{color:t,className:"text-wrap text-center",children:e.jsx(c,{text:d,searchTerm:l})})},Ae=(d,l="")=>{let t;switch(d){case"Brand New":t="gold";break;case"Good Condition":t="green";break;case"Defective":t="red";break;default:t="gray"}return e.jsx(W,{color:t,className:"text-wrap text-center",children:e.jsx(c,{text:d,searchTerm:l})})},ze=(d,l="")=>[{title:"QR Code",dataIndex:"qrCode",key:"qrCode",align:"center",width:"80px",className:"text-xs overflow-auto",responsive:["sm"],render:(t,i)=>e.jsx(pe,{style:{fontSize:"24px",cursor:"pointer"},onClick:()=>d(i),title:"Generate QR Code"})},{title:"ID",dataIndex:"id",key:"id",align:"center",sorter:!0,width:"130px",fixed:"left",className:"text-xs",responsive:["xs","sm","md","lg","xl","xxl"],render:t=>e.jsx(c,{text:t,searchTerm:l})},{title:"Type",dataIndex:"type",key:"type",align:"center",sorter:!0,width:"120px",className:"text-xs overflow-auto",responsive:["sm","md","lg","xl","xxl"],render:t=>e.jsx(c,{text:t,searchTerm:l})},{title:"Brand",dataIndex:"brand",key:"brand",align:"center",sorter:!0,width:"120px",className:"text-xs overflow-auto",responsive:["md","lg","xl","xxl"],render:t=>e.jsx(c,{text:t,searchTerm:l})},{title:"Qty",dataIndex:"quantity",key:"quantity",align:"center",width:"80px",className:"text-xs overflow-auto text-wrap",sorter:(t,i)=>t.quantity-i.quantity,responsive:["xs","sm","md","lg","xl","xxl"],render:t=>e.jsx(c,{text:t,searchTerm:l})},{title:"Remarks",dataIndex:"remarks",key:"remarks",align:"center",width:"200px",className:"text-xs overflow-auto text-wrap",responsive:["lg","xl","xxl"],render:t=>e.jsx(c,{text:t&&t.trim()!==""?t:"-",searchTerm:l})},{title:"Serial Number",dataIndex:"serialNumber",key:"serialNumber",align:"center",sorter:!0,width:"170px",className:"text-xs overflow-auto text-wrap",responsive:["lg","xl","xxl"],render:t=>e.jsx(c,{text:t&&t.trim()!==""?t:"-",searchTerm:l})},{title:"Issued Date",dataIndex:"issuedDate",key:"issuedDate",align:"center",sorter:!0,width:"120px",className:"text-xs overflow-auto",responsive:["md","lg","xl","xxl"],render:t=>!t||t==="0000-00-00"||t===""?e.jsx(c,{text:"NO DATE",searchTerm:l}):e.jsx(c,{text:t,searchTerm:l})},{title:"Purchased Date",dataIndex:"purchaseDate",key:"purchaseDate",align:"center",sorter:!0,width:"120px",className:"text-xs overflow-auto",responsive:["md","lg","xl","xxl"],render:t=>!t||t==="0000-00-00"||t===""?e.jsx(c,{text:"NO DATE",searchTerm:l}):e.jsx(c,{text:t,searchTerm:l})},{title:"Condition",dataIndex:"condition",key:"condition",align:"center",width:"120px",className:"text-xs overflow-auto",responsive:["sm","md","lg","xl","xxl"],render:t=>Ae(t,l),filters:[{text:"Brand New",value:"Brand New"},{text:"Good Condition",value:"Good Condition"},{text:"Defective",value:"Defective"}],onFilter:(t,i)=>i.condition.includes(t)},{title:"Detachment/Office",dataIndex:"location",key:"location",align:"center",width:"150px",className:"text-xs overflow-auto",responsive:["md","lg","xl","xxl"],render:t=>e.jsx(c,{text:t,searchTerm:l})},{title:"Status",dataIndex:"status",key:"status",align:"center",width:"120px",className:"text-xs overflow-auto",responsive:["sm","md","lg","xl","xxl"],render:t=>Re(t,l),filters:[{text:"On Stock",value:"On Stock"},{text:"For Repair",value:"For Repair"},{text:"Deployed",value:"Deployed"}],onFilter:(t,i)=>i.status.includes(t)}],{Option:H}=U,et=({searchText:d,inventoryData:l,loading:t,onRefresh:i,setParentLoading:n,lastSyncTime:B})=>{const[u,O]=a.useState(1),[f,Y]=a.useState(10),[J,E]=a.useState(!1),[X,Z]=a.useState(null),[L,ee]=a.useState("Newest"),[w,M]=a.useState({field:"id",order:"descend"}),[m,N]=a.useState([]),[R,D]=a.useState(!1),te=ke({maxWidth:639}),{theme:j,currentTheme:v}=be(),[se,S]=a.useState(!1),[ae,A]=a.useState(!1),{logUserActivity:h}=ge(),{logUserNotification:p}=we(),b=a.useRef(null),y="dashboard",{filteredData:le,sortedData:z,totalEntries:C}=a.useMemo(()=>{const s=Array.isArray(l)?l.filter(r=>Object.values(r).join(" ").toLowerCase().includes(d.toLowerCase())):[],o=[...s].sort((r,g)=>{if(w.field&&w.order){const{field:x,order:Q}=w;if(Q==="ascend")return r[x]>g[x]?1:-1;if(Q==="descend")return r[x]<g[x]?1:-1}return 0});return{filteredData:s,sortedData:o,totalEntries:o.length}},[l,d,w]),re=a.useMemo(()=>z.slice((u-1)*f,u*f),[z,u,f]),ie=a.useCallback(async(s=!1)=>{try{if(await K()){I.warning("Cannot refresh data while offline");return}if(D(!0),n&&n(!0),Ie(y,s)){const r=Be(y);i&&i(r),n&&n(!1),D(!1);return}const o=await G();$(y,o),i&&i(o)}catch{I.error("Failed to load dashboard data.")}finally{D(!1),n&&n(!1)}},[i,n]),P=a.useCallback(()=>{b.current&&clearInterval(b.current),b.current=setInterval(async()=>{try{if(await K())return;n&&n(!0);const s=await G();$(y,s),i&&i(s),n&&n(!1)}catch(s){console.warn("Background sync failed:",s),Oe(y),n&&n(!1)}},Ee)},[i,n]),V=a.useCallback(()=>{b.current&&(clearInterval(b.current),b.current=null)},[]);a.useEffect(()=>(P(),()=>V()),[P,V]);const ne=a.useCallback(()=>{const s=l.filter(o=>m.includes(o.id));s.length>0?(T(s),h("Printed items from Dashboard",`Printed ${s.length} item(s)`),p("Print Action",`Printed ${s.length} item(s) from Dashboard`),N([])):I.warning("Please select items to print.")},[m,l,h,p]),oe=a.useCallback(()=>{S(!0)},[]),de=a.useCallback(s=>{T(s),h("Batch Print",`Batch printed ${s.length} item(s)`),p("Batch Print",`Batch printed ${s.length} item(s) from Dashboard`),S(!1),N([])},[h,p]),ce=a.useCallback((s,o)=>{O(s),Y(o)},[]),xe=a.useCallback(s=>{const o=s==="Oldest"?"Oldest":"Newest";ee(o),M({field:"id",order:o==="Newest"?"descend":"ascend"}),O(1)},[]),q=a.useCallback(s=>{Z(s),E(!0)},[]),ue=a.useCallback((s,o,r)=>{let g="id",x="descend";Array.isArray(r)?r.length>0&&r[0].field&&(g=r[0].field,x=r[0].order):r&&r.field&&(g=r.field,x=r.order),M({field:g,order:x})},[]),fe=a.useCallback(()=>{A(!0),h("Export","Opened export modal for Dashboard"),p("Export Action","Opened export modal for Dashboard")},[h,p]),F=a.useMemo(()=>ze(q,d),[q,d]),me=a.useMemo(()=>v!=="default"?{background:j.componentBackground,color:j.text}:{},[v,j]),he=a.useMemo(()=>v!=="default"?{color:j.text}:{color:"#072C1C"},[v,j.text]);return e.jsxs("div",{className:"w-full h-full mx-auto bg-[#a7f3d0] rounded-xl shadow border-none p-8",style:me,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 mb-4 space-y-2 sm:space-y-0",children:[e.jsxs(U,{value:L,defaultValue:"Newest",className:"w-full sm:w-auto transparent-select",onChange:xe,size:"small",children:[e.jsx(H,{value:"Newest",children:e.jsx("span",{className:"text-xs text-black",children:"Newest"})}),e.jsx(H,{value:"Oldest",children:e.jsx("span",{className:"text-xs text-black",children:"Oldest"})})]}),e.jsx(k,{onClick:()=>ie(!0),icon:e.jsx(je,{}),size:"small",className:"custom-button text-xs",loading:R,children:R?"Refreshing...":"Refresh"}),e.jsx(k,{onClick:ne,icon:e.jsx(_,{}),size:"small",className:"custom-button text-xs",disabled:m.length===0,children:"Print"}),e.jsx(k,{onClick:oe,icon:e.jsx(_,{}),size:"small",className:"custom-button text-xs",children:"Batch Print"}),e.jsx(k,{onClick:fe,icon:e.jsx(ye,{}),size:"small",className:"custom-button text-xs",children:"Export"})]}),e.jsx("div",{className:"w-auto overflow-x-auto",children:e.jsx(Ne,{rowSelection:{selectedRowKeys:m,onChange:s=>N(s),preserveSelectedRowKeys:!0},columns:F,dataSource:re,pagination:!1,expandable:te?{expandedRowRender:s=>e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",s.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",s.type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Brand:"})," ",s.brand]}),e.jsxs("div",{children:[e.jsx("b",{children:"Quantity:"})," ",s.quantity]}),e.jsxs("div",{children:[e.jsx("b",{children:"Remarks:"})," ",s.remarks]}),e.jsxs("div",{children:[e.jsx("b",{children:"Serial Number:"})," ",s.serialNumber]}),e.jsxs("div",{children:[e.jsx("b",{children:"Issued Date:"})," ",s.issuedDate]}),e.jsxs("div",{children:[e.jsx("b",{children:"Purchased Date:"})," ",s.purchaseDate]}),e.jsxs("div",{children:[e.jsx("b",{children:"Condition:"})," ",s.condition]}),e.jsxs("div",{children:[e.jsx("b",{children:"Detachment/Office:"})," ",s.location]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",s.status]})]}),rowExpandable:()=>!0}:void 0,bordered:!0,rowKey:"id",onChange:ue,sorter:w,scroll:{x:"max-content",y:500},loading:t,responsive:{xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-5 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"w-full flex flex-col items-center sm:items-start",children:[e.jsxs(ve.Text,{style:he,className:"w-full text-xs text-wrap text-center sm:text-left",children:["Showing data of ",C>0?(u-1)*f+1:0," to ",Math.min(u*f,C)," of ",C," entries"]}),B&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-center sm:text-left",children:["Last synced: ",new Date(B).toLocaleTimeString()]})]}),e.jsx("div",{className:"w-full flex justify-center sm:justify-end",children:e.jsx(Me,{current:u,pageSize:f,total:C,showSizeChanger:!0,pageSizeOptions:["10","20","30","50","100","200","500","1000","2000"],onChange:ce,className:"text-xs",responsive:!0})})]}),e.jsx(Ce,{isVisible:J,onClose:()=>E(!1),qrDetails:X}),e.jsx(De,{visible:se,onClose:()=>S(!1),onConfirm:de,loading:t}),e.jsx(Se,{visible:ae,onClose:()=>A(!1),data:l,filteredData:d?le:null,selectedData:m.length>0?l.filter(s=>m.includes(s.id)):null,dataType:"inventory",title:"Export Dashboard Data",columns:F.filter(s=>s.key!=="qrCode").map(s=>({key:s.dataIndex||s.key,label:s.title}))})]})};export{et as default};
