import{r,q as te,t as re,F as p,j as e,M as L,l as ae,B as f,h as m,I as Y,af as ce,d as de,e as ue,b1 as he,n as me,R as xe,T as $,f as pe,ak as fe,by as ye,b2 as ge}from"./index-CD2515kj.js";import{a as X,u as we,b as je,g as Se,c as ve,d as be,e as Ue}from"./usersdata-D6WNMudn.js";import{u as Re,F as Ce}from"./index-DMt-9uzF.js";import{P as Ae}from"./Pagination-pig84kSF.js";import{T as Z}from"./index-8lnpP56V.js";import"./index-95JSFp8s.js";import"./index-vTVWtL-y.js";import"./index-smfr0Mjk.js";var Pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M866.9 169.9L527.1 54.1C523 52.7 517.5 52 512 52s-11 .7-15.1 2.1L157.1 169.9c-8.3 2.8-15.1 12.4-15.1 21.2v482.4c0 8.8 5.7 20.4 12.6 25.9L499.3 968c3.5 2.7 8 4.1 12.6 4.1s9.2-1.4 12.6-4.1l344.7-268.6c6.9-5.4 12.6-17 12.6-25.9V191.1c.2-8.8-6.6-18.3-14.9-21.2zM810 654.3L512 886.5 214 654.3V226.7l298-101.6 298 101.6v427.6zM402.9 528.8l-77.5 77.5a8.03 8.03 0 000 11.3l34 34c3.1 3.1 8.2 3.1 11.3 0l77.5-77.5c55.7 35.1 130.1 28.4 178.6-20.1 56.3-56.3 56.3-147.5 0-203.8-56.3-56.3-147.5-56.3-203.8 0-48.5 48.5-55.2 123-20.1 178.6zm65.4-133.3c31.3-31.3 82-31.3 113.2 0 31.3 31.3 31.3 82 0 113.2-31.3 31.3-82 31.3-113.2 0s-31.3-81.9 0-113.2z"}}]},name:"security-scan",theme:"outlined"},Fe=function(l,n){return r.createElement(te,re({},l,{ref:n,icon:Pe}))},Me=r.forwardRef(Fe),De={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},Ie=function(l,n){return r.createElement(te,re({},l,{ref:n,icon:De}))},Ne=r.forwardRef(Ie);const{Text:ee}=ae,{Option:Ee}=m,Oe=["SOD","CID","GAD","HRD","AFD","EOD","BDO"],Te=({isAddModalVisible:u,setIsAddModalVisible:l,handleAddUser:n,temporaryPassword:y,isPasswordModalVisible:Q,setIsPasswordModalVisible:F,isSecurityQuestionModalVisible:q,setIsSecurityQuestionModalVisible:x,securityQuestions:I,handleChangeSecurityQuestion:N,currentUserSecurityQuestion:j,isRoleModalVisible:w,setIsRoleModalVisible:E,currentUserRole:M,handleRoleUpdate:k})=>{const[O,S]=r.useState(!1),[D]=p.useForm(),[v]=p.useForm(),[U]=p.useForm(),[R,C]=r.useState(null);return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Security Question",open:q,centered:!0,onCancel:()=>{x(!1),S(!1),v.resetFields()},footer:null,children:O?e.jsxs(p,{form:v,onFinish:o=>{N(o),S(!1),x(!1),v.resetFields()},children:[e.jsx(p.Item,{name:"security_question",label:"Security Question",rules:[{required:!0,message:"Please select a security question!"}],children:e.jsx(m,{placeholder:"Select a security question",children:I.map((o,A)=>e.jsx(m.Option,{value:o,children:o},A))})}),e.jsx(p.Item,{name:"security_answer",label:"Security Answer",rules:[{required:!0,message:"Please provide an answer!"}],children:e.jsx(Y.Password,{placeholder:"Enter your answer"})}),e.jsxs("div",{className:"w-auto flex justify-self-end mt-5",children:[e.jsx(f,{onClick:()=>{v.resetFields(),S(!1)},className:"custom-button-cancel",children:"Cancel"}),e.jsx(f,{type:"primary",htmlType:"submit",className:"custom-button ml-2",children:"Save"})]})]}):e.jsx(e.Fragment,{children:j?e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:["Current Security Question: ",e.jsx("strong",{children:j})]}),e.jsx(f,{type:"primary",onClick:()=>S(!0),className:"w-auto flex justify-self-end mt-5 custom-button",children:"Change Security Question"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:"No security question set for this user."}),e.jsx(f,{type:"primary",onClick:()=>S(!0),className:"w-auto flex justify-self-end mt-5 custom-button",children:"Add Security Question"})]})})}),e.jsx(L,{title:"Add User",open:u,centered:!0,onCancel:()=>{l(!1),D.resetFields(),C(null)},footer:null,children:e.jsxs(p,{form:D,onFinish:o=>{n(o),D.resetFields(),C(null),l(!1)},children:[e.jsx(p.Item,{name:"username",label:"Username",rules:[{required:!0,message:"Please input the username!"}],children:e.jsx(Y,{placeholder:"Enter the username"})}),e.jsx(p.Item,{name:"department",label:"Department",rules:[{required:!0,message:"Please select a department!"}],children:e.jsx(m,{placeholder:"Select Department",children:Oe.map(o=>e.jsx(Ee,{value:o,children:o},o))})}),e.jsx(p.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role!"}],children:e.jsxs(m,{placeholder:"Select a role",onChange:o=>C(o),children:[e.jsx(m.Option,{value:"user",children:"User"}),e.jsx(m.Option,{value:"admin",children:"Admin"}),e.jsx(m.Option,{value:"guest",children:"Guest"})]})}),R!=="guest"&&e.jsxs(e.Fragment,{children:[e.jsx(p.Item,{name:"security_question",label:"Security Question",rules:[{required:!0,message:"Please select a security question!"}],children:e.jsx(m,{placeholder:"Select a security question",children:I.map((o,A)=>e.jsx(m.Option,{value:o,children:o},A))})}),e.jsx(p.Item,{name:"security_answer",label:"Security Answer",rules:[{required:!0,message:"Please provide an answer!"}],children:e.jsx(Y.Password,{placeholder:"Enter your answer"})})]}),e.jsx(f,{type:"primary",htmlType:"submit",children:"Add User"})]})}),e.jsx(L,{title:"Temporary Password",open:Q,centered:!0,onCancel:()=>F(!1),footer:null,children:e.jsxs("p",{children:["Your temporary password is: ",y]})}),e.jsx(L,{title:"Edit Role",open:w,centered:!0,onCancel:()=>{E(!1),U.resetFields()},footer:null,afterOpenChange:o=>{o&&U.setFieldsValue({role:M})},children:e.jsxs(p,{form:U,onFinish:o=>{k(o),U.resetFields(),E(!1)},children:[e.jsx(p.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role!"}],children:e.jsxs(m,{children:[e.jsx(m.Option,{value:"user",children:"User"}),e.jsx(m.Option,{value:"admin",children:"Admin"}),e.jsx(m.Option,{value:"guest",children:"Guest"})]})}),e.jsx(f,{type:"primary",htmlType:"submit",className:"flex justify-self-end custom-button",children:"Update Role"})]})})]})},$e=async(u,l)=>{try{const n={userId:u,password:l};return(await ce.post("/reset_password.php",n)).data}catch(n){throw console.error("Reset Password API Error:",n),n}},se=()=>{const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let n=0;n<8;n++)l+=u.charAt(Math.floor(Math.random()*u.length));return l},Qe=()=>{const[u,l]=r.useState([]),[n,y]=r.useState([]),[Q,F]=r.useState(""),[q,x]=r.useState([]),[I,N]=r.useState(!1),[j,w]=r.useState(!1),[E,M]=r.useState(!1),[k,O]=r.useState(""),[S,D]=r.useState([]),[v,U]=r.useState(null),[R,C]=r.useState(null),[o,A]=r.useState(1),[K,B]=r.useState(5),[G,V]=r.useState(!0),[H,z]=r.useState(!1),[J,_]=r.useState(null),[P,W]=r.useState(null),[a,h]=r.useState(!1),{logUserActivity:g}=de(),{logUserNotification:T}=ue(),{message:i,modal:ne}=he.useApp(),oe=async s=>{h(!0);try{const t=await Ue(P,s.role);t.success?(i.success(t.message||"Role updated successfully"),z(!1),l(d=>d.map(c=>c.id===P?{...c,role:s.role}:c)),x(d=>d.map(c=>c.id===P?{...c,role:s.role}:c)),g("Admin","User Management",`Updated the role of user with ID: "${P}" to "${s.role}"`),T("User Management",`You have updated the role of user with ID: "${P}" to "${s.role}"`)):i.error(t.message||"Failed to update role")}catch{i.error("An error occurred while updating the role")}finally{h(!1)}},le=async(s,t)=>{try{const d=await we(s,t);d.success?(i.success("Department updated successfully"),l(c=>c.map(b=>b.id===s?{...b,department:t}:b)),x(c=>c.map(b=>b.id===s?{...b,department:t}:b)),g("Admin","User Management",`Updated the department of user with ID: "${s}" to "${t}"`),T("User Management",`You have updated the department of user with ID: "${s}" to "${t}"`)):i.error(d.message||"Failed to update department")}catch(d){console.error("Error updating department:",d),i.error("Failed to update department")}},ie=s=>{_(s.role),W(s.id),z(!0)};return r.useEffect(()=>{D(["What is your mother's maiden name?","What was the name of your first pet?","What is your favorite color?","In what city were you born?","What is the name of your first school?","What is your favorite movie?","Who is your favorite author?","What is the name of your best friend?","What is your dream job?","Where did you go on your last vacation?"])},[]),r.useEffect(()=>{(async()=>{try{const t=await X();l(t.users),x(t.users)}catch(t){console.error("Error fetching users data:",t)}finally{V(!1)}})()},[]),{users:u,setUsers:l,selectedRowKeys:n,setSelectedRowKeys:y,searchText:Q,setSearchText:F,filteredData:q,setFilteredData:x,isAddModalVisible:I,setIsAddModalVisible:N,isPasswordModalVisible:j,setIsPasswordModalVisible:w,isSecurityQuestionModalVisible:E,setIsSecurityQuestionModalVisible:M,temporaryPassword:k,securityQuestions:S,currentUserSecurityQuestion:v,currentUserId:R,currentPage:o,pageSize:K,loading:G,isRoleModalVisible:H,setIsRoleModalVisible:z,currentUserRole:J,setCurrentUserRole:_,currentUserIdForRole:P,setCurrentUserIdForRole:W,loadingRoleUpdate:a,handleRoleUpdate:oe,showEditRoleModal:ie,onSearch:s=>{const t=s.target.value;F(t);const d=u.filter(c=>Object.values(c).some(b=>String(b).toLowerCase().includes(t.toLowerCase())));x(d)},handlePageChange:(s,t)=>{A(s),B(t)},handleBatchDelete:()=>{L.confirm({title:"Confirm Deletion",content:`Are you sure you want to delete ${n.length} user(s)? This action cannot be undone.`,okText:"Yes, Delete",cancelText:"Cancel",centered:!0,onOk:async()=>{try{const s=await be(n);if(s.success){i.success(s.message||"Users deleted successfully");const t=u.filter(d=>!n.includes(d.id));l(t),x(t),y([]),g("Admin","User Management",`Deleted ${n.length} user(s)`),T("User Management",`You have deleted ${n.length} user(s)`)}else i.error(s.message||"Failed to delete users")}catch(s){console.error("Error deleting users:",s),i.error("Failed to delete users")}}})},handleAddUser:async s=>{if(u.some(c=>c.username.toLowerCase()===s.username.toLowerCase())){i.error("Username already exists. Please choose a different username.");return}const d=se();try{await ve({...s,password:d}),i.success("User added successfully"),O(d),N(!1),w(!0);const c=await X();l(c.users),x(c.users),g("Admin","User Management",`Added a new user with username: "${s.username}"`),T("User Management",`You have added a new user with username: "${s.username}"`)}catch(c){console.error("Error adding user:",c),i.error("Failed to add user")}},handleResetPassword:s=>{ne.confirm({title:"Are you sure you want to reset the password?",content:"This action will reset the user's password to a temporary one.",okText:"Yes",cancelText:"No",centered:!0,okButtonProps:{className:"custom-button"},cancelButtonProps:{className:"custom-button-cancel"},onOk:async()=>{const t=se();try{await $e(s,t),i.success("Password reset successfully"),O(t),w(!0),g("Admin","User Management",`Reset the password for user with ID: "${s}"`),T("User Management",`You have reset the password for user with ID: "${s}"`)}catch(d){console.error("Error resetting password:",d),i.error("Failed to reset password")}}})},handleSecurityQuestion:async s=>{try{const t=await Se(s);t.success?(U(t.security_question),C(s),M(!0)):i.error("Failed to fetch security question")}catch(t){console.error("Error fetching security question:",t),i.error("Failed to fetch security question")}},handleChangeSecurityQuestion:async s=>{try{const t=await je(R,s.security_question,s.security_answer);t.success?(i.success("Security question updated successfully."),M(!1),g("Admin","User Management",`Updated the security question for user with ID: "${R}"`),T("User Management",`You have updated the security question for user with ID: "${R}"`)):i.error(t.message||"Failed to update security question.")}catch(t){console.error("Error updating security question:",t),i.error("Failed to update security question.")}},handleDepartmentUpdate:le,refreshUsers:async()=>{V(!0),F(""),A(1),B(5),y([]),x([]);try{const s=await X();l(s.users),x(s.users)}catch(s){console.error("Error fetching users data:",s),i.error("Failed to refresh users data")}finally{V(!1)}}}},{Text:qe}=ae,{Option:ke}=m,Ve=["SOD","CID","GAD","HRD","AFD","EOD","BDO"],as=()=>{const u=Re({maxWidth:639}),{selectedRowKeys:l,searchText:n,filteredData:y,isAddModalVisible:Q,isPasswordModalVisible:F,isSecurityQuestionModalVisible:q,temporaryPassword:x,securityQuestions:I,currentUserSecurityQuestion:N,currentPage:j,pageSize:w,loading:E,isRoleModalVisible:M,setIsRoleModalVisible:k,currentUserRole:O,loadingRoleUpdate:S,setSelectedRowKeys:D,setIsAddModalVisible:v,setIsPasswordModalVisible:U,setIsSecurityQuestionModalVisible:R,onSearch:C,handlePageChange:o,handleBatchDelete:A,handleAddUser:K,handleResetPassword:B,handleSecurityQuestion:G,showEditRoleModal:V,handleRoleUpdate:H,handleChangeSecurityQuestion:z,handleDepartmentUpdate:J,refreshUsers:_}=Qe(),P=[{title:"ID",dataIndex:"id",key:"id",width:"100px",responsive:["sm"],sorter:(a,h)=>a.id-h.id,className:"text-xs overflow-auto"},{title:"Username",dataIndex:"username",key:"username",width:"120px",className:"text-xs overflow-auto",sorter:(a,h)=>a.username.localeCompare(h.username)},{title:"Department",dataIndex:"department",key:"department",width:"140px",className:"text-xs overflow-auto text-wrap",sorter:(a,h)=>a.department.localeCompare(h.department),render:(a,h)=>e.jsx(m,{value:a,style:{width:"auto"},size:u?"small":"middle",onChange:g=>J(h.id,g),disabled:h.role==="guest",className:"transparent-select",children:Ve.map(g=>e.jsx(ke,{value:g,children:g},g))})},{title:"Role",dataIndex:"role",key:"role",className:"text-xs overflow-auto",responsive:["sm"],width:"120px",render:a=>e.jsx(Z,{color:a==="admin"?"blue":a==="user"?"green":"orange",children:a})},{title:"Status",dataIndex:"status",key:"status",responsive:["sm"],width:"120px",className:"text-xs overflow-auto",render:a=>e.jsx(Z,{color:a==="Active"?"green":"red",children:a})},{title:"Actions",key:"actions",className:"text-xs overflow-auto",width:"120px",render:(a,h)=>e.jsxs("div",{children:[e.jsx($,{title:"Reset Password",children:e.jsx(f,{icon:e.jsx(ye,{}),type:"text",onClick:()=>B(h.id)})}),h.role!=="guest"&&e.jsx($,{title:"Security Question",children:e.jsx(f,{icon:e.jsx(Me,{}),type:"text",onClick:()=>G(h.id)})}),e.jsx($,{title:"Edit Role",children:e.jsx(f,{icon:e.jsx(ge,{}),type:"text",onClick:()=>V(h),loading:S})})]})}],W={selectedRowKeys:l,onChange:a=>D(a)};return e.jsxs(me,{title:e.jsx("span",{className:"text-lgi sm:text-sm md:text-md lg:text-lgi xl:text-xl font-bold flex justify-center",children:"ALL USERS"}),className:"flex flex-col w-full mx-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:[e.jsxs("div",{className:"flex justify-start items-center mb-4 space-x-2",children:[e.jsx(Y,{placeholder:"Search users...",prefix:e.jsx(xe,{}),value:n,onChange:C,className:"w-auto text-xs border border-black",suffix:n?e.jsx(f,{type:"text",onClick:()=>{C({target:{value:""}})},className:"text-xs",size:"small",tabIndex:-1,style:{padding:0,height:"auto",lineHeight:1},children:"×"}):null}),e.jsx($,{title:"Add User",children:e.jsx(f,{icon:e.jsx(Ne,{}),type:"text",onClick:()=>v(!0)})}),e.jsx($,{title:"Delete",children:e.jsx(f,{type:"link",icon:e.jsx(pe,{}),danger:!0,disabled:l.length===0,onClick:A})}),e.jsx($,{title:"Refresh",children:e.jsx(f,{type:"text",icon:e.jsx(fe,{}),onClick:_,className:"w-auto text-xs",size:"small"})})]}),e.jsx("div",{className:"w-auto overflow-x-auto",children:e.jsx(Ce,{columns:P,dataSource:y.slice((j-1)*w,j*w),pagination:!1,bordered:!0,rowKey:"id",rowSelection:W,className:"w-auto",loading:E,responsive:["xs","sm","md","lg","xl"],scroll:{x:"max-content",y:300},expandable:u?{expandedRowRender:a=>e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",a.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Username:"})," ",a.username]}),e.jsxs("div",{children:[e.jsx("b",{children:"Department:"})," ",a.department]}),e.jsxs("div",{children:[e.jsx("b",{children:"Role:"})," ",a.role]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",a.status]})]}),rowExpandable:()=>!0}:void 0})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-5 space-y-2 sm:space-y-0",children:[e.jsxs(qe,{style:{color:"#072C1C"},className:"w-full text-xs text-wrap text-center sm:text-left",children:["Showing ",Math.min((j-1)*w+1,y.length)," to"," ",Math.min(j*w,y.length)," of ",y.length," entries"]}),e.jsx("div",{className:"w-full flex justify-center sm:justify-end",children:e.jsx(Ae,{current:j,pageSize:w,total:y.length,showSizeChanger:!0,pageSizeOptions:["5","10","15"],onChange:o,className:"text-xs",responsive:!0})})]}),e.jsx(Te,{isAddModalVisible:Q,setIsAddModalVisible:v,handleAddUser:K,temporaryPassword:x,isPasswordModalVisible:F,setIsPasswordModalVisible:U,isSecurityQuestionModalVisible:q,setIsSecurityQuestionModalVisible:R,securityQuestions:I,handleChangeSecurityQuestion:z,currentUserSecurityQuestion:N,isRoleModalVisible:M,setIsRoleModalVisible:k,currentUserRole:O,handleRoleUpdate:H})]})};export{as as default};
