import{d as S,e as B,j as e,f as N,B as b,g as A,h as w,s as y,F as k,M as I,I as P,i as Y,r as f,p as R,k as T,l as z,u as L,D as $,m as O,a as G,C as u,L as _,S as C,n as q}from"./index-D_DjqwU6.js";import{d as K,a as H,f as J}from"./eventService-BWRv56zX.js";import{A as Q,C as V}from"./index-Z_iRrtms.js";import{B as W}from"./index-CaMH7yIx.js";import{T as h}from"./index-BlUNoHI2.js";import"./index-Bc3K6vAP.js";import"./index-CRHxdFZf.js";import"./useBubbleLock-BNMpLRc-.js";const X=({currentDate:d,info:i,events:r,showModal:j,isAdmin:x,currentUser:a,setEvents:g,isGuest:p})=>{const{logUserActivity:o}=S(),{logUserNotification:v}=B();if(i.type==="date"){const t=d.format("YYYY-MM-DD"),E=r[t]||[],D=s=>{K(s.id).then(l=>{l.success?(g(c=>{const n={...c},F=n[t].filter(M=>M.id!==s.id);return n[t]=F,n}),y.success("Event deleted successfully!"),o((a==null?void 0:a.username)||"Unknown User","Event",`Deleted an event: "${s.content}"`),v("Event Deleted",`Deleted an event: "${s.content}"`)):y.error(l.message||"Failed to delete event")}).catch(l=>{console.error("Failed to delete event:",l),y.error("Error deleting event. Please try again.")})};return e.jsxs("ul",{className:"events",children:[E.map(s=>e.jsxs("li",{children:[e.jsx(N,{title:s.username,className:"size-3 sm:size-5",children:e.jsx(Q,{src:s.avatar})}),e.jsx(W,{color:s.type,text:e.jsx("span",{style:{color:s.type},className:"text-xxs sm:text-xs",children:s.content})}),(x||s.username===(a==null?void 0:a.username))&&e.jsx(N,{title:"Delete Event",children:e.jsx(b,{className:"size-1",size:"small",type:"link",danger:!0,icon:e.jsx(A,{}),style:{padding:0},onClick:()=>D(s)})})]},s.id)),!p&&e.jsx(N,{title:"Add Event",children:e.jsx(b,{className:"size-1",size:"small",type:"link",icon:e.jsx(w,{}),onClick:()=>j(d),style:{padding:0}})})]})}return null},{Option:m}=Y,Z=({isOpen:d,onClose:i,selectedDate:r,loadEvents:j})=>{const[x]=k.useForm(),{logUserActivity:a}=S(),{logUserNotification:g}=B(),p=()=>{x.validateFields().then(o=>{const v={date:r.format("YYYY-MM-DD"),content:o.event,event_type:o.color};H(v).then(t=>{t.success?(y.success("Event added successfully!"),x.resetFields(),j(),i(),a(t.username,"Event",`Added an event: "${o.event}"`),g("New event scheduled!",`Your upcoming event "${o.event}" is scheduled for ${r.format("YYYY-MM-DD")}.`)):y.error(t.message||"Failed to add event.")}).catch(t=>{y.error("Failed to add event."),console.error("Failed to add event:",t)})})};return e.jsx(I,{title:`Add Event on ${r?r.format("YYYY-MM-DD"):""}`,open:d,onOk:p,onCancel:i,okButtonProps:{className:"custom-button"},cancelButtonProps:{className:"custom-button-cancel"},centered:!0,children:e.jsxs(k,{form:x,layout:"vertical",children:[e.jsx(k.Item,{name:"event",label:"Event Description",rules:[{required:!0,message:"Please input the event description!"}],children:e.jsx(P,{})}),e.jsx(k.Item,{name:"color",label:"Event Color",rules:[{required:!0,message:"Please select a color for the event!"}],children:e.jsxs(Y,{placeholder:"Select a category",allowClear:!0,children:[e.jsx(m,{value:"#4169E1",children:"Important (Royal Blue)"}),e.jsx(m,{value:"#FFD700",children:"Celebration (Gold)"}),e.jsx(m,{value:"#228B22",children:"Task (Forest Green)"}),e.jsx(m,{value:"#4682B4",children:"Meeting (Steel Blue)"}),e.jsx(m,{value:"#FFC0CB",children:"Personal (Soft Pink)"}),e.jsx(m,{value:"#B22222",children:"Deadline (Firebrick Red)"}),e.jsx(m,{value:"#FFFFE0",children:"Idea (Pale Yellow)"})]})})]})})},{Title:U}=O,ce=()=>{f.useEffect(()=>{R([C])},[]);const[d,i]=f.useState({}),[r,j]=f.useState(!1),[x,a]=f.useState(null),{userData:g}=T(),{userData:p}=z(),o=!!p,v=g||p,{theme:t,currentTheme:E}=L();f.useEffect(()=>{D()},[]);const D=()=>{J().then(l=>{const c={};l.forEach(n=>{const F=n.event_date;c[F]||(c[F]=[]),c[F].push({id:n.id,type:n.event_type,content:n.content,avatar:n.avatar||"",username:n.username||""})}),i(c)}).catch(l=>{console.error("Failed to fetch events:",l)})},s=l=>{a(l),j(!0)};return e.jsx(f.Suspense,{fallback:e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-honeydew",children:[e.jsx(_,{className:"h-[183px] w-[171px] object-cover mb-4 logo-bounce",src:C,alt:"SINSSI Logo",width:171,height:183}),e.jsx(q,{size:"large"}),e.jsx("p",{className:"mt-4 text-darkslategray-200",children:"Loading..."})]}),children:e.jsxs("div",{className:"container max-w-full",children:[e.jsx("div",{className:"mt-5",children:e.jsx($,{style:E!=="default"?{borderColor:t.text}:{borderColor:"#072C1C"},children:e.jsx(U,{level:3,style:E!=="default"?{color:t.text}:{},children:"CALENDAR"})})}),e.jsxs(G,{gutter:[16,8],className:"mb-2 justify-center",children:[e.jsxs(u,{xs:12,sm:6,md:3,children:[e.jsx(h,{color:"#4169E1",children:"Important"}),e.jsx("span",{children:"Royal Blue"})]}),e.jsxs(u,{xs:12,sm:6,md:3,children:[e.jsx(h,{color:"#FFD700",style:{color:"black"},children:"Celebration"}),e.jsx("span",{children:"Gold"})]}),e.jsxs(u,{xs:12,sm:6,md:3,children:[e.jsx(h,{color:"#228B22",children:"Task"}),e.jsx("span",{children:"Forest Green"})]}),e.jsxs(u,{xs:12,sm:6,md:3,children:[e.jsx(h,{color:"#4682B4",children:"Meeting"}),e.jsx("span",{children:"Steel Blue"})]}),e.jsxs(u,{xs:12,sm:6,md:3,children:[e.jsx(h,{color:"#FFC0CB",style:{color:"black"},children:"Personal"}),e.jsx("span",{children:"Soft Pink"})]}),e.jsxs(u,{xs:12,sm:6,md:3,children:[e.jsx(h,{color:"#B22222",children:"Deadline"}),e.jsx("span",{children:"Firebrick Red"})]}),e.jsxs(u,{xs:12,sm:6,md:3,children:[e.jsx(h,{color:"#FFFFE0",style:{color:"black"},children:"Idea"}),e.jsx("span",{children:"Pale Yellow"})]})]}),e.jsxs("div",{className:"flex flex-col w-full h-auto mx-auto bg-[#a7f3d0] rounded-xl shadow p-2",style:E!=="default"?{background:t.componentBackground,color:t.text}:{},children:[e.jsx(V,{className:"text-xs w-full",cellRender:(l,c)=>e.jsx(X,{currentDate:l,info:c,events:d,showModal:s,isAdmin:o,currentUser:v,setEvents:i,isGuest:!o&&!v})}),e.jsx(Z,{isOpen:r,onClose:()=>j(!1),selectedDate:x,loadEvents:D,events:d})]})]})})};export{ce as default};
