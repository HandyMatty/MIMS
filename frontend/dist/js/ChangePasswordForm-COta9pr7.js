import{A as B,r as u,e as T,d as M,b as D,c as U,u as H,j as e,B as h,s as a,D as q}from"./index-Bfv_RYKM.js";import{F as n}from"./index-v5vGacUn.js";import{C as z}from"./index-C2F5TDUc.js";import{R as N}from"./LockOutlined-CJjaVE5S.js";import{D as R}from"./index-Bj5Ss5MQ.js";import{T as V}from"./index-mXndb-Dc.js";import{I as p}from"./index-eFG5XlKP.js";import"./row-DVtG68eM.js";import"./responsiveObserver-DpdOGnt2.js";import"./PlusOutlined-BmIFcUcQ.js";import"./Dropdown-DdpZg6k3.js";import"./TextArea-Bk2TBN4c.js";import"./CheckOutlined-nId50N2-.js";import"./EyeOutlined-ChXYwmpH.js";import"./SearchOutlined-DVBhVuGZ.js";const _=async(m,r)=>{try{return(await B.put("/changePassword.php",r,{headers:{Authorization:`Bearer ${m}`}})).data}catch(l){throw console.error("Password update API Error:",l),l}},{Title:$}=V,ne=({onClose:m=()=>{}})=>{const[r]=n.useForm(),[l,g]=u.useState(!1),[k,w]=u.useState(!1),A=T(),E=M(),{logUserActivity:S}=D(),{logUserNotification:F}=U(),{theme:s,currentTheme:t}=H(),[y,b]=u.useState(!1),[d,i]=u.useState(!1),I=async()=>{var c,x;try{const o=await r.validateFields(),{currentPassword:P,newPassword:v}=o;if(P===v){a.error("New password cannot be the same as the current password");return}const f=((c=A.userData)==null?void 0:c.username)||((x=E.userData)==null?void 0:x.username);if(!f){a.error("User not authenticated!");return}const j=q.get(`authToken_${f}`);if(!j){a.error("Authentication token not found!");return}g(!0);const C=await _(j,{currentPassword:P,newPassword:v});C.success?(a.success("Password changed successfully!"),r.resetFields(),w(!1),m(),S(f,"Password","This user changed password"),F("Password Update","Your password was successfully updated.")):a.error(C.message||"Failed to change password")}catch(o){a.error(o.message||"Error occurred while changing password")}finally{g(!1)}},L=()=>{r.resetFields(),w(!1)};return e.jsx(z,{className:"flex flex-col justify-center items-center w-auto bg-[#a7f3d0] rounded-xl shadow border-none",style:t!=="default"?{background:s.componentBackground,color:s.text}:{},children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[515px]",children:e.jsxs("div",{className:"flex flex-col justify-center items-center rounded-xl bg-honeydew shadow p-6",style:t!=="default"?{background:s.textLight}:{},children:[e.jsx(N,{style:{fontSize:"60px",color:t!=="default"?s.text:"#072C1C"}}),e.jsx(R,{style:t!=="default"?{borderColor:s.text}:{borderColor:"#072C1C"},children:e.jsx($,{level:3,className:"w-40 text-wrap text-center text-lgi sm:text-sm font-bold",style:t!=="default"?{color:s.text}:{},children:"Change Password"})}),k?e.jsxs(n,{form:r,layout:"horizontal",onFinish:I,className:"w-auto mt-10",children:[e.jsx(n.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please input your current password!"}],children:e.jsx(p.Password,{placeholder:"Enter current password",autoComplete:"current-password",className:"w-full bg-white text-xs sm:text-sm"})}),e.jsx(n.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please input your new password!"}],children:e.jsx(p.Password,{placeholder:"Enter new password",autoComplete:"new-password",className:"w-full bg-white text-xs sm:text-sm"})}),e.jsx(n.Item,{name:"confirmPassword",label:"Confirm Password",rules:[{required:!0,message:"Please confirm your new password!"},({getFieldValue:c})=>({validator(x,o){return!o||c("newPassword")===o?Promise.resolve():Promise.reject(new Error("Passwords do not match!"))}})],children:e.jsx(p.Password,{placeholder:"Confirm new password",autoComplete:"new-password",className:"w-full bg-white text-xs sm:text-sm"})}),e.jsx(n.Item,{style:{textAlign:"center"},children:e.jsxs("div",{className:"flex justify-center sm:flex-row mt-5",children:[e.jsx(h,{className:"mr-2 bg-red-500 text-white w-auto",type:"default",onClick:L,style:t!=="default"?{background:y?s.text:s.sider,color:y?s.textLight:s.text,border:"none",transition:"background 0.2s, color 0.2s"}:{},onMouseEnter:t!=="default"?()=>b(!0):void 0,onMouseLeave:t!=="default"?()=>b(!1):void 0,children:"Cancel"}),e.jsx(h,{className:"bg-lime-200 text-green-950 w-auto",type:"primary",htmlType:"submit",loading:l,style:t!=="default"?{background:d?s.sider:s.text,color:d?s.text:s.textLight,border:"none",transition:"background 0.2s, color 0.2s"}:{},onMouseEnter:t!=="default"?()=>i(!0):void 0,onMouseLeave:t!=="default"?()=>i(!1):void 0,children:"Save"})]})})]}):e.jsx(h,{type:"primary",className:"bg-lime-200 text-green-950 w-auto text-wrap mt-10",icon:e.jsx(N,{}),onClick:()=>w(!0),style:t!=="default"?{background:d?s.textLight:s.text,color:d?s.text:s.textLight,border:"none",transition:"background 0.2s, color 0.2s"}:{},onMouseEnter:t!=="default"?()=>i(!0):void 0,onMouseLeave:t!=="default"?()=>i(!1):void 0,children:"Change Password"})]})})})};export{ne as default};
