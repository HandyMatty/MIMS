import{A as T,r as a,g as C,d as P,c as D,e as E,u as G,i as k,D as L,p as $,S as I,j as e,L as U,B as z,a as F}from"./index-CvNWCSBk.js";import{v as R}from"./vectors-D4bo22xO.js";import{R as B,a as M}from"./EyeOutlined-CuRghNh0.js";const O=async o=>{try{return(await T.post("/login.php",o)).data}catch(l){throw console.error("Login API Error:",l),l}},V=()=>{const[o,l]=a.useState(null),[d,x]=a.useState(!1),c=C(),{setUserData:w,setToken:p,setRole:b}=P(),{setUserData:u,setToken:v,setRole:A}=D(),{setUserData:f,setToken:y,setRole:n}=E(),{logUserActivity:m}=G(),S=async(s,i,g)=>{x(!0),l(null);try{t();const j=await O({username:s,password:i,rememberMe:g});if(j.success){const{token:h,role:r}=j,N=JSON.stringify({userData:{username:s,role:r},token:h});return sessionStorage.setItem(`${r}Auth`,N),localStorage.setItem(`${r}Auth`,N),k.set(`authToken_${s}`,h,{expires:g?7:1,secure:window.location.protocol==="https:",sameSite:"Lax",path:"/"}),r==="admin"?(w({username:s}),b(r),p(h),m(s,"Login","This admin just logged in"),c("/admin/dashboard",{replace:!0})):r==="user"?(u({username:s}),A(r),v(h),m(s,"Login","This user just logged in"),c("/user/dashboard",{replace:!0})):r==="guest"&&(f({username:s}),n(r),y(h),m(s,"Login","This guest just logged in"),c("/guest/dashboard",{replace:!0})),{success:!0}}else return{success:!1,message:j.message||"Login failed"}}catch{return l("Failed to log in. Please try again."),{success:!1,message:"Login failed due to a network error."}}finally{x(!1)}},t=()=>{const s=k.get();Object.keys(s).forEach(i=>{i.startsWith("authToken_")&&!s[i]&&(["adminAuth","userAuth","guestAuth"].forEach(g=>{localStorage.removeItem(g),sessionStorage.removeItem(g)}),k.remove(i))})};return{mutate:S,isLoading:d,error:o}},J=()=>{const{message:o}=L.useApp(),{notification:l}=L.useApp(),[d,x]=a.useState(""),[c,w]=a.useState(""),[p,b]=a.useState(!1),[u,v]=a.useState(!1),{mutate:A,isLoading:f,error:y}=V(),n=C();a.useEffect(()=>{const t=localStorage.getItem("adminAuth"),s=localStorage.getItem("userAuth"),i=localStorage.getItem("guestAuth");t?n("/admin/dashboard",{replace:!0}):s?n("/user/dashboard",{replace:!0}):i&&n("/guest/dashboard",{replace:!0})},[n]),a.useEffect(()=>{$([I,R])},[]);const m=async t=>{if(t.preventDefault(),!d){o.warning("Please enter your username.");return}if(!c){o.warning("Please enter your password.");return}try{const s=await A(d,c,p);s.success?l.success({message:`Welcome Back, ${d}!`,description:"You have successfully logged in. Enjoy your session!",placement:"topRight"}):o.error(s.message||"Login failed. Please check your credentials.")}catch{o.error("Login failed. Please try again.")}},S=a.useCallback(()=>{n("/forgotpassword",{replace:!0})},[n]);return e.jsx(a.Suspense,{fallback:e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-honeydew",children:[e.jsx(F,{size:"large"}),e.jsx("p",{className:"mt-4 text-darkslategray-200",children:"Loading..."})]}),children:e.jsxs("div",{className:"relative flex flex-col items-center justify-center h-screen bg-honeydew overflow-hidden",children:[e.jsx(U,{className:"absolute bottom-0 left-0 w-full h-auto object-cover z-0",style:{maxHeight:"100vh"},src:R,alt:"vector bg"}),e.jsx("div",{className:"relative z-10 w-auto h-auto sm:w-full sm:h-full flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-5xl",children:e.jsx("main",{className:"flex flex-col items-center justify-center h-full p-4",children:e.jsx("section",{className:"w-auto sm:w-full max-w-md bg-honeydew p-6 rounded-lg shadow-lg",children:e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"flex flex-col items-center mb-10",children:[e.jsx(U,{className:"w-auto h-auto sm:w-[130px] sm:h-[130px ] object-contain",src:I,alt:"SINSSI Logo"}),e.jsx("h1",{className:"text-32xl mt-5 sm:text-45xl font-lexend-deca text-darkslategray-100 text-center",children:"Sign in"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{id:"username",type:"text",placeholder:"Username",value:d,onChange:t=>x(t.target.value),className:"w-full bg-darkslategray-100 text-palegoldenrod placeholder-palegoldenrod text-xs sm:text-sm py-6 pl-2 rounded-3xs",autoComplete:"username"})}),e.jsxs("div",{className:"mb-4 relative",children:[e.jsx("input",{id:"password",type:u?"text":"password",placeholder:"Password",value:c,onChange:t=>w(t.target.value),className:"w-full bg-darkslategray-100 text-palegoldenrod placeholder-palegoldenrod text-xs sm:text-sm py-6 pl-2 rounded-3xs",autoComplete:"current-password"}),e.jsx("button",{type:"button",onClick:()=>v(!u),className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-0 border-none bg-transparent cursor-pointer",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:u?e.jsx(B,{style:{color:"palegoldenrod"}}):e.jsx(M,{style:{color:"palegoldenrod"}})})]}),e.jsxs("div",{className:"flex flex-col items-center mt-6",children:[e.jsxs("div",{className:"flex justify-between w-full mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"rememberMe",checked:p,onChange:t=>b(t.target.checked),className:"mr-2"}),e.jsx("label",{htmlFor:"rememberMe",className:"text-xs sm:text-sm font-montserrat text-darkslategray-100",children:"Remember me"})]}),e.jsx("div",{className:"text-xs sm:text-sm font-lexend-deca text-darkslategray-100 cursor-pointer",onClick:S,children:"Forgot password?"})]}),e.jsx("p",{className:"text-center mt-4 text-darkslategray-100 ",children:"Sign in and start managing your inventory!"}),e.jsx(z,{type:"primary",htmlType:"submit",className:"w-2/4 mt-2 bg-palegoldenrod text-darkslategray-100 py-5 rounded-3xs shadow-md",loading:f,children:f?"Logging in...":"Login"}),y&&e.jsx("p",{className:"text-red-500 text-center",children:y})]})]})})})})})]})})};export{J as default};
