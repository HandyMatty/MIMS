import{u as Y,b,j as e,T as S,B as C,s as v,M as w,r as f,p as B,c as I,d as R,L as P,S as N,a as T}from"./index-1bUjThPI.js";import{A as z,d as L,a as $,f as O,C as G}from"./eventService-CaLfCiHq.js";import{B as _}from"./index-OxXb5Gs0.js";import{R as q}from"./DeleteOutlined-mNjCBndF.js";import{R as K}from"./PlusOutlined-DjyVkQwf.js";import{F as g}from"./index-DlZFTL0H.js";import{I as H}from"./index-HYYCmbw9.js";import{S as k}from"./index-qPlGQ91r.js";import{D as J}from"./index-CdxV5g3D.js";import{T as Q}from"./index-0WLxIj05.js";import{R as V,C as x}from"./row-AIHCUI2m.js";import{T as m}from"./index-BwRQR_cB.js";import"./responsiveObserver-D0DgaF8s.js";import"./useBreakpoint-GvLrBt9J.js";import"./useForceUpdate-CHj89O7T.js";import"./index-B3CrsbZy.js";import"./TextArea-DpRMIGjb.js";import"./index-CIDkA5ML.js";import"./EyeOutlined-D12zyJAU.js";import"./SearchOutlined-CVLzcg_r.js";import"./CheckOutlined-DLAhGfjk.js";const W=({currentDate:c,info:i,events:r,showModal:p,isAdmin:d,currentUser:a,setEvents:y,isGuest:u})=>{const{logUserActivity:n}=Y(),{logUserNotification:j}=b();if(i.type==="date"){const t=c.format("YYYY-MM-DD"),F=r[t]||[],o=s=>{L(s.id).then(l=>{l.success?(y(E=>{const D={...E},A=D[t].filter(M=>M.id!==s.id);return D[t]=A,D}),v.success("Event deleted successfully!"),n((a==null?void 0:a.username)||"Unknown User","Event",`Deleted an event: "${s.content}"`),j("Event Deleted",`Deleted an event: "${s.content}"`)):v.error(l.message||"Failed to delete event")}).catch(l=>{console.error("Failed to delete event:",l),v.error("Error deleting event. Please try again.")})};return e.jsxs("ul",{className:"events",children:[F.map(s=>e.jsxs("li",{children:[e.jsx(S,{title:s.username,className:"size-3 sm:size-5",children:e.jsx(z,{src:s.avatar})}),e.jsx(_,{color:s.type,text:e.jsx("span",{style:{color:s.type},className:"text-xxs sm:text-xs",children:s.content})}),(d||s.username===(a==null?void 0:a.username))&&e.jsx(S,{title:"Delete Event",children:e.jsx(C,{className:"size-1",size:"small",type:"link",danger:!0,icon:e.jsx(q,{}),style:{padding:0},onClick:()=>o(s)})})]},s.id)),!u&&e.jsx(S,{title:"Add Event",children:e.jsx(C,{className:"size-1",size:"small",type:"link",icon:e.jsx(K,{}),onClick:()=>p(c),style:{padding:0}})})]})}return null},{Option:h}=k,X=({isOpen:c,onClose:i,selectedDate:r,loadEvents:p})=>{const[d]=g.useForm(),{logUserActivity:a}=Y(),{logUserNotification:y}=b(),u=()=>{d.validateFields().then(n=>{const j={date:r.format("YYYY-MM-DD"),content:n.event,event_type:n.color};$(j).then(t=>{t.success?(v.success("Event added successfully!"),d.resetFields(),p(),i(),a(t.username,"Event",`Added an event: "${n.event}"`),y("New event scheduled!",`Your upcoming event "${n.event}" is scheduled for ${r.format("YYYY-MM-DD")}.`)):v.error(t.message||"Failed to add event.")}).catch(t=>{v.error("Failed to add event."),console.error("Failed to add event:",t)})})};return e.jsx(w,{title:`Add Event on ${r?r.format("YYYY-MM-DD"):""}`,open:c,onOk:u,onCancel:i,centered:!0,children:e.jsxs(g,{form:d,layout:"vertical",children:[e.jsx(g.Item,{name:"event",label:"Event Description",rules:[{required:!0,message:"Please input the event description!"}],children:e.jsx(H,{})}),e.jsx(g.Item,{name:"color",label:"Event Color",rules:[{required:!0,message:"Please select a color for the event!"}],children:e.jsxs(k,{placeholder:"Select a category",allowClear:!0,children:[e.jsx(h,{value:"#4169E1",children:"Important (Royal Blue)"}),e.jsx(h,{value:"#FFD700",children:"Celebration (Gold)"}),e.jsx(h,{value:"#228B22",children:"Task (Forest Green)"}),e.jsx(h,{value:"#4682B4",children:"Meeting (Steel Blue)"}),e.jsx(h,{value:"#FFC0CB",children:"Personal (Soft Pink)"}),e.jsx(h,{value:"#B22222",children:"Deadline (Firebrick Red)"}),e.jsx(h,{value:"#FFFFE0",children:"Idea (Pale Yellow)"})]})})]})})},{Title:Z}=Q,Ee=()=>{f.useEffect(()=>{B([N])},[]);const[c,i]=f.useState({}),[r,p]=f.useState(!1),[d,a]=f.useState(null),{userData:y}=I(),{userData:u}=R(),n=!!u,j=y||u;f.useEffect(()=>{t()},[]);const t=()=>{O().then(o=>{const s={};o.forEach(l=>{const E=l.event_date;s[E]||(s[E]=[]),s[E].push({id:l.id,type:l.event_type,content:l.content,avatar:l.avatar||"",username:l.username||""})}),i(s)}).catch(o=>{console.error("Failed to fetch events:",o)})},F=o=>{a(o),p(!0)};return e.jsx(f.Suspense,{fallback:e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-honeydew",children:[e.jsx(P,{className:"h-[183px] w-[171px] object-cover mb-4 logo-bounce",src:N,alt:"SINSSI Logo",width:171,height:183}),e.jsx(T,{size:"large"}),e.jsx("p",{className:"mt-4 text-darkslategray-200",children:"Loading..."})]}),children:e.jsxs("div",{className:"container max-w-full",children:[e.jsx("div",{className:"mt-5",children:e.jsx(J,{style:{borderColor:"#072C1C"},children:e.jsx(Z,{level:3,children:"CALENDAR"})})}),e.jsxs(V,{className:"flex flex-col sm:flex-row justify-center items-center gap-4 mb-2",children:[e.jsxs(x,{span:2,children:[e.jsx(m,{color:"#4169E1",children:"Important"}),e.jsx("span",{children:"Royal Blue"})]}),e.jsxs(x,{span:2,children:[e.jsx(m,{color:"#FFD700",style:{color:"black"},children:"Celebration"}),e.jsx("span",{children:"Gold"})]}),e.jsxs(x,{span:2,children:[e.jsx(m,{color:"#228B22",children:"Task"}),e.jsx("span",{children:"Forest Green"})]}),e.jsxs(x,{span:2,children:[e.jsx(m,{color:"#4682B4",children:"Meeting"}),e.jsx("span",{children:"Steel Blue"})]}),e.jsxs(x,{span:2,children:[e.jsx(m,{color:"#FFC0CB",style:{color:"black"},children:"Personal"}),e.jsx("span",{children:"Soft Pink"})]}),e.jsxs(x,{span:2,children:[e.jsx(m,{color:"#B22222",children:"Deadline"}),e.jsx("span",{children:"Firebrick Red"})]}),e.jsxs(x,{span:2,children:[e.jsx(m,{color:"#FFFFE0",style:{color:"black"},children:"Idea"}),e.jsx("span",{children:"Pale Yellow"})]})]}),e.jsxs("div",{className:"flex flex-col w-full h-auto mx-auto bg-[#A8E1C5] rounded-xl shadow p-2",children:[e.jsx(G,{className:"text-xs w-full",cellRender:(o,s)=>e.jsx(W,{currentDate:o,info:s,events:c,showModal:F,isAdmin:n,currentUser:j,setEvents:i,isGuest:!n&&!j})}),e.jsx(X,{isOpen:r,onClose:()=>p(!1),selectedDate:d,loadEvents:t,events:c})]})]})})};export{Ee as default};
