import{j as e,aG as xe,aH as d,x as K,r as a,bl as me,i as V,g as z,h as fe,J as he,B as G,be,bn as pe,I as ge,R as ye,k as H,aI as je,aK as we,w as ke,P as Ce,u as ve}from"./index-Cq9w5H2m.js";import{Q as Ne}from"./QrCodeModal-C35tkzz5.js";import{u as Se}from"./index-CVya9Qnf.js";import{i as De,g as Ie,u as _,m as Re,S as Me}from"./cacheUtils-rgXBj3X0.js";import{R as Oe}from"./FilterOutlined-CqFZr8Fa.js";import"./qrCodeUtils-DEq3Bs4U.js";import"./createForOfIteratorHelper-ZMyofER8.js";const Ae=(n,r="")=>{let o;switch(n){case"On Stock":o="green";break;case"For Repair":o="volcano";break;case"Deployed":o="blue";break;default:o="gray"}return e.jsx(K,{color:o,className:"text-wrap text-center",children:e.jsx(d,{text:n,searchTerm:r})})},Be=(n,r="")=>{let o;switch(n){case"Brand New":o="gold";break;case"Good Condition":o="green";break;case"Defective":o="red";break;default:o="gray"}return e.jsx(K,{color:o,className:"text-wrap text-center",children:e.jsx(d,{text:n,searchTerm:r})})},Ee=(n,r="",o={},c={})=>[{title:"QR Code",dataIndex:"qrCode",key:"qrCode",align:"center",width:"70px",className:"text-xs overflow-auto",render:(t,l)=>e.jsx(xe,{style:{fontSize:"24px",cursor:"pointer"},onClick:()=>n(l),title:"Generate QR Code"})},{title:"ID",dataIndex:"id",key:"id",align:"center",fixed:"left",className:"text-xs",width:"120px",sorter:(t,l)=>Number(t.id)-Number(l.id),render:t=>e.jsx(d,{text:t,searchTerm:r})},{title:"Type",dataIndex:"type",key:"type",align:"center",className:"text-xs overflow-auto",responsive:["sm"],width:"120px",sorter:(t,l)=>t.type.localeCompare(l.type),render:t=>e.jsx(d,{text:t,searchTerm:r})},{title:"Brand",dataIndex:"brand",key:"brand",align:"center",className:"text-xs overflow-auto",width:"120px",responsive:["sm"],sorter:(t,l)=>t.brand.localeCompare(l.brand),render:t=>e.jsx(d,{text:t,searchTerm:r})},{title:"Qty",dataIndex:"quantity",key:"quantity",align:"center",className:"text-xs overflow-auto text-wrap",responsive:["sm"],width:"80px",sorter:(t,l)=>t.quantity-l.quantity,render:t=>e.jsx(d,{text:t,searchTerm:r})},{title:"Remarks",dataIndex:"remarks",key:"remarks",align:"center",className:"text-xs overflow-auto text-wrap",responsive:["sm"],width:"200px",render:t=>e.jsx(d,{text:t&&t.trim()!==""?t:"-",searchTerm:r})},{title:"Serial Number",dataIndex:"serialNumber",key:"serialNumber",align:"center",width:"170px",className:"text-xs overflow-auto text-wrap",responsive:["sm"],sorter:(t,l)=>t.serialNumber.localeCompare(l.serialNumber),render:t=>e.jsx(d,{text:t&&t.trim()!==""?t:"-",searchTerm:r})},{title:"Issued Date",dataIndex:"issuedDate",key:"issuedDate",align:"center",className:"text-xs overflow-auto",width:"110px",responsive:["sm"],sorter:(t,l)=>t.issuedDate.localeCompare(l.issuedDate),render:t=>!t||t==="0000-00-00"||t===""?e.jsx(d,{text:"NO DATE",searchTerm:r}):e.jsx(d,{text:t,searchTerm:r})},{title:"Purchased Date",dataIndex:"purchaseDate",key:"purchaseDate",align:"center",width:"110px",className:"text-xs overflow-auto",responsive:["sm"],sorter:(t,l)=>t.purchaseDate.localeCompare(l.purchaseDate),render:t=>!t||t==="0000-00-00"||t===""?e.jsx(d,{text:"NO DATE",searchTerm:r}):e.jsx(d,{text:t,searchTerm:r})},{title:"Condition",dataIndex:"condition",key:"condition",align:"center",width:"120px",className:"text-xs overflow-auto",responsive:["sm"],render:t=>Be(t,r),filters:[{text:"Brand New",value:"Brand New"},{text:"Good Condition",value:"Good Condition"},{text:"Defective",value:"Defective"}],filteredValue:c.condition||null,onFilter:(t,l)=>l.condition===t},{title:"Detachment/Office",dataIndex:"location",key:"location",align:"center",width:"150px",className:"text-xs overflow-auto",responsive:["sm"],render:t=>e.jsx(d,{text:t,searchTerm:r})},{title:"Status",dataIndex:"status",key:"status",align:"center",width:"120px",className:"text-xs overflow-auto",responsive:["sm"],render:t=>Ae(t,r),filters:[{text:"On Stock",value:"On Stock"},{text:"For Repair",value:"For Repair"},{text:"Deployed",value:"Deployed"}],filteredValue:c.status||null,onFilter:(t,l)=>l.status===t}],{Option:$}=H,Qe=()=>{const{theme:n,currentTheme:r}=ve(),o=r!=="default"&&n.border||"#d1d5db",c=r!=="default"&&n.componentBackground||"#A8E1C5";return e.jsxs("div",{className:"w-full h-full mx-auto rounded-xl shadow border-none p-8 table-skeleton",style:{backgroundColor:c},children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 mb-4 space-y-2 sm:space-y-0",children:[...Array(5)].map((t,l)=>e.jsx("div",{className:"h-8 rounded w-20 animate-pulse",style:{backgroundColor:o}},l))}),e.jsx("div",{className:"w-auto overflow-x-auto",children:e.jsxs("div",{className:"table-skeleton",children:[e.jsx("div",{className:"table-skeleton-row rounded mb-2 animate-pulse",style:{backgroundColor:o}}),[...Array(5)].map((t,l)=>e.jsx("div",{className:"table-skeleton-row rounded mb-2 animate-pulse",style:{backgroundColor:o}},l))]})}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{className:"h-4 rounded w-32 animate-pulse",style:{backgroundColor:o}}),e.jsx("div",{className:"h-8 rounded w-48 animate-pulse",style:{backgroundColor:o}})]})]})},Ge=({inventoryData:n=[],loading:r=!1,error:o=null,onRefresh:c,onItemSelect:t,lastSyncTime:l})=>{var L,q;const[w,J]=a.useState(""),[k,W]=a.useState("Newest"),[f,C]=a.useState(1),[h,Y]=a.useState(10),[U,S]=a.useState(!1),[v,N]=a.useState(null),[m,X]=a.useState("all"),[D,Z]=a.useState([]),[I,R]=a.useState(!1),[u,ee]=a.useState({}),[M,O]=a.useState(!1),A=Se({maxWidth:639}),b=a.useRef(null),g="qrcode";a.useEffect(()=>{n.length>0&&!v&&(t(n[0]),N(n[0]))},[n,v,t]);const y=a.useMemo(()=>[{key:"all",label:"All Columns"},{key:"id",label:"ID"},{key:"type",label:"Type"},{key:"brand",label:"Brand"},{key:"quantity",label:"Quantity"},{key:"remarks",label:"Remarks"},{key:"serialNumber",label:"Serial Number"},{key:"issuedDate",label:"Issued Date"},{key:"purchaseDate",label:"Purchase Date"},{key:"location",label:"Location"},{key:"status",label:"Status"},{key:"condition",label:"Condition"}],[]),B=a.useMemo(()=>me(s=>{if(s===""){R(!1);return}R(!0);const i=n.filter(x=>{if(!x)return!1;if(m==="all"){for(const j in x){const P=x[j];if(P&&String(P).toLowerCase().includes(s.toLowerCase()))return!0}return!1}else{const j=x[m];return j&&String(j).toLowerCase().includes(s.toLowerCase())}});Z(i)},300),[n,m]),te=a.useCallback(s=>{const i=s.target.value;J(i),B(i)},[B]),se=a.useCallback(s=>{X(s)},[]),ae=a.useCallback(async(s=!1)=>{try{if(await V()){console.warn("Cannot refresh QR code data while offline");return}if(O(!0),De(g,s)){const x=Ie(g);c&&c(x);return}const i=await z();_(g,i),c&&c(i)}catch(i){console.error("Failed to load QR code data:",i)}finally{O(!1)}},[c]),E=a.useCallback(()=>{b.current&&clearInterval(b.current),b.current=setInterval(async()=>{try{if(await V())return;const s=await z();_(g,s),c&&c(s)}catch(s){console.warn("Background sync failed:",s),Re(g)}},Me)},[c]),Q=a.useCallback(()=>{b.current&&(clearInterval(b.current),b.current=null)},[]);a.useEffect(()=>(E(),()=>Q()),[E,Q]);const le=a.useCallback(s=>{W(s),C(1)},[]),re=a.useCallback((s,i)=>{C(s),Y(i)},[]),ne=a.useCallback((s,i,x)=>{ee(i),C(1)},[]),T=a.useCallback(s=>{N(s),S(!0)},[]),oe=a.useCallback(s=>{t(s),N(s)},[t]),F=a.useMemo(()=>{let s=I?D:n;return u.condition&&u.condition.length>0&&(s=s.filter(i=>u.condition.includes(i.condition))),u.status&&u.status.length>0&&(s=s.filter(i=>u.status.includes(i.status))),s},[I,D,n,u]),p=a.useMemo(()=>{const s=[...F].sort((i,x)=>Number(i.id)-Number(x.id));return k==="Newest"?s.reverse():s},[F,k]),ie=a.useMemo(()=>y.map(s=>({key:s.key,label:s.label})),[y]),ce=a.useMemo(()=>p.slice((f-1)*h,f*h),[p,f,h]),de=a.useMemo(()=>Ee(T,w,void 0,u),[T,w,u]),ue=a.useMemo(()=>A?{expandedRowRender:s=>e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",s.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",s.type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Brand:"})," ",s.brand]}),e.jsxs("div",{children:[e.jsx("b",{children:"Quantity:"})," ",s.quantity]}),e.jsxs("div",{children:[e.jsx("b",{children:"Remarks:"})," ",s.remarks]}),e.jsxs("div",{children:[e.jsx("b",{children:"Serial Number:"})," ",s.serialNumber]}),e.jsxs("div",{children:[e.jsx("b",{children:"Issued Date:"})," ",s.issuedDate]}),e.jsxs("div",{children:[e.jsx("b",{children:"Purchased Date:"})," ",s.purchaseDate]}),e.jsxs("div",{children:[e.jsx("b",{children:"Condition:"})," ",s.condition]}),e.jsxs("div",{children:[e.jsx("b",{children:"Location:"})," ",s.location]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",s.status]})]}),rowExpandable:()=>!0}:void 0,[A]);return r?e.jsx(Qe,{}):e.jsxs(fe,{title:e.jsx("span",{className:"text-lgi sm:text-sm md:text-base lg:text-lgi xl:text-xl font-bold flex justify-center",children:"ITEMS"}),className:"flex flex-col w-full mx-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 mb-4 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-2 sm:mb-0",children:[e.jsx(he,{className:"theme-aware-dropdown-btn border border-black sm:block hidden",menu:{items:ie,onClick:({key:s})=>se(s),selectedKeys:[m]},trigger:["click"],children:e.jsx(G,{type:"text",size:"small",className:"text-xs",icon:e.jsx(Oe,{}),children:e.jsxs(be,{className:"text-xs w-auto align-middle",children:[((L=y.find(s=>s.key===m))==null?void 0:L.label)||"All Columns",e.jsx(pe,{})]})})}),e.jsx(ge,{placeholder:`Search in ${m==="all"?"all columns":(q=y.find(s=>s.key===m))==null?void 0:q.label}`,prefix:e.jsx(ye,{}),className:"border border-black w-auto ml-1 text-xs h-6",value:w,allowClear:!0,onChange:te})]}),e.jsxs("div",{className:"flex gap-2 w-auto justify-center ",children:[e.jsxs(H,{value:k,className:"w-auto text-xs transparent-select",size:"small",onChange:le,children:[e.jsx($,{value:"Newest",children:e.jsx("span",{className:"text-xs",children:"Newest"})}),e.jsx($,{value:"Oldest",children:e.jsx("span",{className:"text-xs",children:"Oldest"})})]}),e.jsx(G,{onClick:()=>ae(!0),className:"custom-button text-xs",type:"default",size:"small",icon:e.jsx(je,{}),loading:M,children:e.jsx("span",{className:"text-xs",children:M?"Refreshing...":"Refresh"})})]})]}),e.jsx(we,{rowKey:"id",columns:de,dataSource:ce,pagination:!1,bordered:!0,sortDirections:["descend","ascend"],onChange:ne,onRow:s=>({onClick:()=>oe(s)}),scroll:{x:"max-content",y:600},responsive:["sm","md","lg","xl","xxl"],expandable:ue}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-5 space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"w-full flex flex-col items-center sm:items-start",children:[e.jsxs(ke.Text,{style:{color:"#072C1C"},className:"w-full text-xs text-wrap text-center sm:text-left",children:["Showing data of ",p.length>0?(f-1)*h+1:0," to"," ",Math.min(f*h,p.length)," of ",p.length," entries"]}),l&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-center sm:text-left",children:["Last synced: ",new Date(l).toLocaleTimeString()]})]}),e.jsx("div",{className:"w-full flex justify-center sm:justify-end",children:e.jsx(Ce,{current:f,pageSize:h,total:p.length,showSizeChanger:!0,pageSizeOptions:["10","20","30","50","100","200","500","1000","2000"],onChange:re,className:"text-xs",responsive:!0})})]}),e.jsx(Ne,{isVisible:U,onClose:()=>S(!1),qrDetails:v})]})};export{Ge as default};
