import{a0 as N,r as m,u as C,b as E,j as e,B as d,s as a,o as F}from"./index-1bUjThPI.js";import{F as y}from"./index-DlZFTL0H.js";import{T as W}from"./index-0WLxIj05.js";import{C as A}from"./index-yJHKc8mb.js";import{D}from"./index-CdxV5g3D.js";import{S as b}from"./index-qPlGQ91r.js";import{I as U}from"./index-HYYCmbw9.js";import{D as h}from"./index-Cui3dGfa.js";import"./row-AIHCUI2m.js";import"./responsiveObserver-D0DgaF8s.js";import"./TextArea-DpRMIGjb.js";import"./CheckOutlined-DLAhGfjk.js";import"./PlusOutlined-DjyVkQwf.js";import"./SearchOutlined-CVLzcg_r.js";import"./EyeOutlined-D12zyJAU.js";import"./useBreakpoint-GvLrBt9J.js";import"./useForceUpdate-CHj89O7T.js";const T=async n=>{try{return(await N.get("/getSecurityQuestion.php",{headers:{Authorization:`Bearer ${n}`}})).data}catch(o){throw console.error("Error fetching security question:",o),o}},O=async(n,o,u)=>{try{return(await N.post("/getSecurityQuestion.php",{security_question:o,security_answer:u},{headers:{Authorization:`Bearer ${n}`}})).data}catch(i){throw console.error("Error updating security question:",i),i}},re=()=>{const[n,o]=m.useState(!1),[u]=y.useForm(),[i,p]=m.useState({question:"",answer:""}),[I,c]=m.useState(!1),{logUserActivity:Q}=C(),{logUserNotification:_}=E(),{Text:P}=W,k=["What is your mother's maiden name?","What was the name of your first pet?","What is your favorite color?","In what city were you born?","What is the name of your first school?","What is your favorite movie?","Who is your favorite author?","What is the name of your best friend?","What is your dream job?","Where did you go on your last vacation?"],f=()=>{var g,x,S,w,j,q;const t=JSON.parse(localStorage.getItem("userAuth"))||JSON.parse(sessionStorage.getItem("userAuth")),s=JSON.parse(localStorage.getItem("adminAuth"))||JSON.parse(sessionStorage.getItem("adminAuth")),r=((x=(g=t==null?void 0:t.state)==null?void 0:g.userData)==null?void 0:x.username)||((w=(S=s==null?void 0:s.state)==null?void 0:S.userData)==null?void 0:w.username);if(!r)return a.error("User not authenticated!"),null;let l=F.get(`authToken_${r}`);return!l&&(l=((j=t==null?void 0:t.state)==null?void 0:j.token)||((q=s==null?void 0:s.state)==null?void 0:q.token),!l)?(a.error("Authentication token is missing. Please log in again."),null):l};m.useEffect(()=>{(async()=>{const s=f();if(s)try{c(!0);const r=await T(s);r.success?p({question:r.security_question,answer:""}):a.error(r.message||"Failed to fetch security question.")}catch{a.error("Failed to fetch security question.")}finally{c(!1)}})()},[]);const v=async t=>{const s=f();if(s)try{c(!0);const r=await O(s,t.security_question,t.security_answer);r.success?(a.success("Security question updated successfully."),Q("Profile Update",`Updated security question: "${t.security_question}"`),_("Security Question Updated","Your security question was successfully updated."),o(!1),p({question:t.security_question,answer:t.security_answer})):a.error(r.message||"Failed to update security question.")}catch{a.error("Failed to update security question.")}finally{c(!1),u.resetFields()}};return e.jsxs(A,{className:"flex flex-col w-full bg-[#A8E1C5] rounded-3xl shadow p-6 border-none",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(D,{style:{borderColor:"#072C1C"},className:"text-xl font-semibold",children:"Security Question"})}),n?e.jsxs(y,{form:u,onFinish:v,initialValues:i,children:[e.jsx(y.Item,{name:"security_question",label:"Select a Security Question",rules:[{required:!0,message:"Please select a security question!"}],children:e.jsx(b,{placeholder:"Select a security question",children:k.map((t,s)=>e.jsx(b.Option,{value:t,children:t},s))})}),e.jsx(y.Item,{name:"security_answer",label:"Security Answer",rules:[{required:!0,message:"Please provide an answer!"}],children:e.jsx(U.Password,{placeholder:"Enter your answer"})}),e.jsxs("div",{className:"flex justify-center",children:[e.jsx(d,{onClick:()=>o(!1),className:"bg-red-500 text-white mr-2",children:"Cancel"}),e.jsx(d,{type:"primary",htmlType:"submit",loading:I,className:"bg-lime-200 text-green-950 ml-2",children:"Submit"})]})]}):e.jsxs(h,{column:1,layout:"horizontal",bordered:!0,className:"text-nowrap overflow-auto w-auto",children:[e.jsx(h.Item,{label:"Current Security Question",children:i.question||"Not set"}),e.jsx(h.Item,{label:"Security Answer",children:(i.answer,"********")})]}),!n&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(d,{type:"primary",onClick:()=>o(!0),className:"bg-lime-200 text-green-950",children:"Edit"})})]})};export{re as default};
