import{a0 as E,r as g,d as F,c as I,u as S,b as T,j as e,B as u,s as t,o as k}from"./index-1bUjThPI.js";import{F as a}from"./index-DlZFTL0H.js";import{C as U}from"./index-yJHKc8mb.js";import{R as y}from"./LockOutlined-O7WFeRsV.js";import{D}from"./index-CdxV5g3D.js";import{T as q}from"./index-0WLxIj05.js";import{I as m}from"./index-HYYCmbw9.js";import"./row-AIHCUI2m.js";import"./responsiveObserver-D0DgaF8s.js";import"./PlusOutlined-DjyVkQwf.js";import"./TextArea-DpRMIGjb.js";import"./CheckOutlined-DLAhGfjk.js";import"./EyeOutlined-D12zyJAU.js";import"./SearchOutlined-CVLzcg_r.js";const z=async(i,s)=>{try{return(await E.put("/changePassword.php",s,{headers:{Authorization:`Bearer ${i}`}})).data}catch(o){throw console.error("Password update API Error:",o),o}},{Title:B}=q,X=({onClose:i=()=>{}})=>{const[s]=a.useForm(),[o,w]=g.useState(!1),[P,l]=g.useState(!1),j=F(),C=I(),{logUserActivity:b}=S(),{logUserNotification:N}=T(),A=async()=>{var n,c;try{const r=await s.validateFields(),{currentPassword:p,newPassword:h}=r;if(p===h){t.error("New password cannot be the same as the current password");return}const d=((n=j.userData)==null?void 0:n.username)||((c=C.userData)==null?void 0:c.username);if(!d){t.error("User not authenticated!");return}const x=k.get(`authToken_${d}`);if(!x){t.error("Authentication token not found!");return}w(!0);const f=await z(x,{currentPassword:p,newPassword:h});f.success?(t.success("Password changed successfully!"),s.resetFields(),l(!1),i(),b(d,"Password","This user changed password"),N("Password Update","Your password was successfully updated.")):t.error(f.message||"Failed to change password")}catch(r){t.error(r.message||"Error occurred while changing password")}finally{w(!1)}},v=()=>{s.resetFields(),l(!1)};return e.jsx(U,{className:"flex flex-col justify-center items-center w-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[515px]",children:e.jsxs("div",{className:`flex flex-col justify-center items-center\r
         bg-[#EAF4E2] rounded-xl shadow p-6`,children:[e.jsx(y,{style:{fontSize:"60px",color:"#072C1C"}}),e.jsxs(D,{style:{borderColor:"#072C1C"},children:[" ",e.jsx(B,{level:3,className:"w-40 text-wrap text-center text-lgi sm:text-sm font-bold",children:"Change Password"})]}),P?e.jsxs(a,{form:s,layout:"horizontal",onFinish:A,className:"w-auto mt-10",children:[e.jsx(a.Item,{name:"currentPassword",label:"Current Password",rules:[{required:!0,message:"Please input your current password!"}],children:e.jsx(m.Password,{placeholder:"Enter current password",autoComplete:"current-password",className:"w-full bg-white text-xs sm:text-sm"})}),e.jsx(a.Item,{name:"newPassword",label:"New Password",rules:[{required:!0,message:"Please input your new password!"}],children:e.jsx(m.Password,{placeholder:"Enter new password",autoComplete:"new-password",className:"w-full bg-white text-xs sm:text-sm"})}),e.jsx(a.Item,{name:"confirmPassword",label:"Confirm Password",rules:[{required:!0,message:"Please confirm your new password!"},({getFieldValue:n})=>({validator(c,r){return!r||n("newPassword")===r?Promise.resolve():Promise.reject(new Error("Passwords do not match!"))}})],children:e.jsx(m.Password,{placeholder:"Confirm new password",autoComplete:"new-password",className:"w-full bg-white text-xs sm:text-sm"})}),e.jsx(a.Item,{style:{textAlign:"center"},children:e.jsxs("div",{className:"flex justify-center sm:flex-row mt-5",children:[e.jsx(u,{className:"mr-2 bg-red-500 text-white w-auto",type:"default",onClick:v,children:"Cancel"}),e.jsx(u,{className:"bg-lime-200 text-green-950 w-auto",type:"primary",htmlType:"submit",loading:o,children:"Save"})]})})]}):e.jsx(u,{type:"primary",className:"bg-lime-200 text-green-950 w-auto text-wrap mt-10",icon:e.jsx(y,{}),onClick:()=>l(!0),children:"Change Password"})]})})})};export{X as default};
