import{s as pe,k as e,H as y,B as k,T as ie,M as fe,r as o,t as ge,n as ye,u as me,v as U,w as P,x as T,y as q,o as K,p as Q,z as V,F as G,E as Y,G as J}from"./index-BY-OqtzB.js";const je=async()=>{try{return(await pe.get("/getHistory.php")).data}catch(s){throw console.error("Error fetching history:",s),s}},be=s=>{const b={"On Stock":"green","For Repair":"volcano",Deployed:"blue"};return e.jsx(ie,{color:b[s]||"gray",children:s})},ke=s=>{const b={"Brand New":"gold","Good Condition":"green",Defective:"red"};return e.jsx(ie,{color:b[s]||"gray",children:s})},W=(s,b,l="")=>{let w=[{title:"ID",dataIndex:"id",key:"id",align:"center",sorter:!0,width:100,fixed:"left",render:d=>e.jsx(y,{text:d,searchTerm:l})},{title:"Action",dataIndex:"action",key:"action",align:"center",width:150,fixed:"left",render:d=>e.jsx(y,{text:d,searchTerm:l})},{title:"Action Date",dataIndex:"action_date",key:"action_date",align:"center",sorter:!0,width:180,render:d=>{if(!d||d==="0000-00-00"||d==="")return e.jsx(y,{text:"NO DATE",searchTerm:l});const g=new Date(d),F=`${g.getMonth()+1}/${g.getDate()}/${g.getFullYear()}`;return e.jsx(y,{text:F,searchTerm:l})},fixed:"left"},{title:"Item ID",dataIndex:"item_id",key:"item_id",align:"center",sorter:!0,width:120,fixed:"left",render:d=>e.jsx(y,{text:d,searchTerm:l})}];return(b==="Added"||b==="Deleted")&&w.push({title:"Type",dataIndex:"type",key:"type",align:"center",width:120,render:d=>e.jsx(y,{text:d,searchTerm:l})},{title:"Brand",dataIndex:"brand",key:"brand",align:"center",width:120,render:d=>e.jsx(y,{text:d,searchTerm:l})},{title:"Qty",dataIndex:"quantity",key:"quantity",align:"center",width:100,sorter:(d,g)=>d.quantity-g.quantity,render:d=>e.jsx(y,{text:d,searchTerm:l})},{title:"Remarks",dataIndex:"remarks",key:"remarks",align:"center",width:200,render:d=>e.jsx(y,{text:d&&d.trim()!==""?d:"-",searchTerm:l})},{title:"Serial No.",dataIndex:"serial_number",key:"serial_number",align:"center",width:200,render:d=>e.jsx(y,{text:d&&d.trim()!==""?d:"-",searchTerm:l})},{title:"Issued Date",dataIndex:"issued_date",key:"issued_date",align:"center",sorter:!0,width:150,render:d=>e.jsx(y,{text:!d||d==="0000-00-00"?"NO DATE":d,searchTerm:l})},{title:"Purchased Date",dataIndex:"purchase_date",key:"purchase_date",align:"center",sorter:!0,width:150,render:d=>e.jsx(y,{text:d,searchTerm:l})},{title:"Condition",dataIndex:"condition",key:"condition",align:"center",width:150,render:d=>ke(d),filters:[{text:"Brand New",value:"Brand New"},{text:"Good Condition",value:"Good Condition"},{text:"Defective",value:"Defective"}],onFilter:(d,g)=>g.condition.includes(d)},{title:"Detachment/Office",dataIndex:"location",key:"location",align:"center",width:150,render:d=>e.jsx(y,{text:d,searchTerm:l})},{title:"Status",dataIndex:"status",key:"status",align:"center",width:120,render:d=>be(d),filters:[{text:"On Stock",value:"On Stock"},{text:"For Repair",value:"For Repair"},{text:"Deployed",value:"Deployed"}],onFilter:(d,g)=>g.status.includes(d)}),b==="Updated"&&w.push({title:"Field Changed",dataIndex:"field_changed",key:"field_changed",align:"center",width:200,render:d=>e.jsx(y,{text:d?d.join(", "):"N/A",searchTerm:l})},{title:"Changed Details",key:"changed_details",align:"center",width:250,render:(d,g)=>e.jsx(k,{type:"link",onClick:()=>s(g),children:"View Changes"})}),w},Ce=({visible:s,onClose:b,record:l})=>l?e.jsx(fe,{title:"Changed Details",open:s,onCancel:b,footer:null,children:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Item ID:"})," ",l.item_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Action Date:"})," ",new Date(l.action_date).toLocaleString()]}),Array.isArray(l.field_changed)&&l.field_changed.length>0?l.field_changed.map((w,d)=>e.jsxs("div",{children:[e.jsx("p",{children:e.jsxs("strong",{children:[w,":"]})}),e.jsxs("p",{style:{color:"red",textDecoration:"line-through"},children:["Old: ",l.old_value[d]??"N/A"]}),e.jsxs("p",{style:{color:"green"},children:["New: ",l.new_value[d]??"N/A"]}),e.jsx("hr",{})]},d)):e.jsx("p",{children:"No changes recorded."})]})}):null,we=()=>{var de,ae,le,ne,se,re;const[s,b]=o.useState([]),[l,w]=o.useState(!0),[d,g]=o.useState(!1),[F,oe]=o.useState(null),[x,X]=o.useState({added:"",updated:"",deleted:""}),[p,Z]=o.useState({added:1,updated:1,deleted:1}),[f,ce]=o.useState({added:10,updated:10,deleted:10}),[S,ee]=o.useState({added:{field:null,order:null},updated:{field:null,order:null},deleted:{field:null,order:null}}),[j,te]=o.useState({added:"all",updated:"all",deleted:"all"}),[c,ue]=o.useState({added:[],updated:[],deleted:[]}),[u,z]=o.useState({added:!1,updated:!1,deleted:!1}),D=[{key:"all",label:"All Columns"},{key:"id",label:"ID"},{key:"action",label:"Action"},{key:"action_date",label:"Action Date"},{key:"item_id",label:"Item ID"},{key:"type",label:"Type"},{key:"brand",label:"Brand"},{key:"quantity",label:"Quantity"},{key:"field_changed",label:"Field Changed"},{key:"serial_number",label:"Serial Number"},{key:"location",label:"Location"},{key:"status",label:"Status"},{key:"condition",label:"Condition"}];o.useEffect(()=>{(async()=>{try{const a=await je();b(a)}catch(a){console.error("Error fetching history data:",a)}finally{w(!1)}})()},[]);const R=(t,a,n)=>{const m=t.filter(r=>Object.values(r).some(C=>C==null?void 0:C.toString().toLowerCase().includes(a.toLowerCase())));return n.field&&n.order?[...m].sort((r,C)=>{const h=r[n.field],i=C[n.field];return n.field==="id"?n.order==="ascend"?h-i:i-h:typeof h=="string"&&typeof i=="string"?n.order==="ascend"?h.localeCompare(i):i.localeCompare(h):n.order==="ascend"?h>i?1:-1:h<i?1:-1}):m},N=o.useMemo(()=>R(s.filter(t=>t.action==="Added"),x.added,S.added),[s,x.added,S.added]),v=o.useMemo(()=>R(s.filter(t=>t.action==="Updated"||t.action==="QRCode Update"),x.updated,S.updated),[s,x.updated,S.updated]),I=o.useMemo(()=>R(s.filter(t=>t.action==="Deleted"),x.deleted,S.deleted),[s,x.deleted,S.deleted]),M=o.useMemo(()=>!u.added&&!u.updated&&!u.deleted?{added:N,updated:v,deleted:I}:{added:c.added,updated:c.updated,deleted:c.deleted},[u,c,N,v,I]),he=o.useCallback(ge((t,a)=>{if(a===""){z(r=>({...r,[t]:!1}));return}z(r=>({...r,[t]:!0}));const m=s.filter(r=>t==="added"?r.action==="Added":t==="updated"?r.action==="Updated"||r.action==="QRCode Update":t==="deleted"?r.action==="Deleted":!1).filter(r=>{if(!r)return!1;const C=j[t];if(C==="all"){for(const h in r){const i=r[h];if(h==="action_date"){if(i){const A=new Date(i);if(`${A.getMonth()+1}/${A.getDate()}/${A.getFullYear()}`.includes(a)||i.includes(a))return!0}}else if(i&&String(i).toLowerCase().includes(a.toLowerCase()))return!0}return!1}else{const h=r[C];if(C==="action_date"){if(h){const i=new Date(h);return`${i.getMonth()+1}/${i.getDate()}/${i.getFullYear()}`.includes(a)||h.includes(a)}return!1}return h&&String(h).toLowerCase().includes(a.toLowerCase())}});ue(r=>({...r,[t]:m}))},300),[s,j]),$=(t,a)=>{const n=a.target.value;X(m=>({...m,[t]:n})),he(t,n)},xe=(t,a)=>{te(n=>({...n,[t]:a}))},_=t=>{X(a=>({...a,[t]:""})),te(a=>({...a,[t]:"all"})),z(a=>({...a,[t]:!1})),Z(a=>({...a,[t]:1}))},O=(t,a,n)=>{Z(m=>({...m,[t]:a})),ce(m=>({...m,[t]:n}))},H=(t,a,n,m)=>{ee(r=>({...r,[t]:{field:m.field,order:m.order}}))},L=t=>{oe(t),g(!0)},E=t=>({items:D.map(a=>({key:a.key,label:a.label})),onClick:({key:a})=>xe(t,a),selectedKeys:[j[t]]}),B=t=>{_(t),ee(a=>({...a,[t]:{field:null,order:null}}))};return e.jsxs(ye,{title:e.jsx("span",{className:"text-5xl-6 font-bold flex justify-center",children:"HISTORY"}),className:"flex flex-col w-full mx-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:[e.jsx(me,{defaultActiveKey:"1",type:"card",items:[{key:"1",label:"Added",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex mb-4",children:[e.jsx(U,{menu:E("added"),trigger:["click"],children:e.jsx(k,{type:"text",className:"border-black bg-[#a7f3d0]",icon:e.jsx(q,{}),children:e.jsxs(P,{children:[((de=D.find(t=>t.key===j.added))==null?void 0:de.label)||"All Columns",e.jsx(T,{})]})})}),e.jsx(K,{placeholder:`Search in ${j.added==="all"?"all columns":(ae=D.find(t=>t.key===j.added))==null?void 0:ae.label}`,prefix:e.jsx(Q,{style:{color:"black"}}),value:x.added,onChange:t=>$("added",t),className:"bg-transparent custom-input-history custom-input-table w-64 border-r-black border-b-black border-t-black",suffix:x.added?e.jsx(k,{type:"text",size:"small",onClick:()=>_("added"),children:"Ã—"}):null}),e.jsx("div",{className:"ml-2",children:e.jsx(k,{onClick:()=>B("added"),className:"custom-button",type:"default",size:"small",icon:e.jsx(V,{}),children:"Reset"})})]}),e.jsx("div",{style:{height:"680px"},children:e.jsx(G,{rowKey:"id",dataSource:M.added.slice((p.added-1)*f.added,p.added*f.added),columns:W(L,"Added",x.added),bordered:!0,pagination:!1,onChange:(t,a,n)=>H("added",t,a,n),scroll:{x:"max-content",y:620},loading:l})}),e.jsxs("div",{className:"flex items-center justify-between mt-5",children:[e.jsxs(Y.Text,{style:{color:"#072C1C"},children:["Showing ",(u.added?c.added:N).length>0?(p.added-1)*f.added+1:0," to"," ",Math.min(p.added*f.added,(u.added?c.added:N).length),"of ",(u.added?c.added:N).length," entries"]}),e.jsx(J,{current:p.added,pageSize:f.added,total:(u.added?c.added:N).length,showSizeChanger:!0,pageSizeOptions:["10","20","30"],onChange:(t,a)=>O("added",t,a)})]})]})},{key:"2",label:"Updated / QRCode Update",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex mb-4",children:[e.jsx(U,{menu:E("updated"),trigger:["click"],children:e.jsx(k,{type:"text",className:"border-black bg-[#a7f3d0]",icon:e.jsx(q,{}),children:e.jsxs(P,{children:[((le=D.find(t=>t.key===j.updated))==null?void 0:le.label)||"All Columns",e.jsx(T,{})]})})}),e.jsx(K,{placeholder:`Search in ${j.updated==="all"?"all columns":(ne=D.find(t=>t.key===j.updated))==null?void 0:ne.label}`,prefix:e.jsx(Q,{style:{color:"black"}}),value:x.updated,onChange:t=>$("updated",t),className:"bg-transparent custom-input-history custom-input-table w-64 border-r-black border-b-black border-t-black",suffix:x.updated?e.jsx(k,{type:"text",size:"small",onClick:()=>_("updated"),children:"Ã—"}):null}),e.jsx("div",{className:"ml-2",children:e.jsx(k,{onClick:()=>B("updated"),className:"custom-button",type:"default",size:"small",icon:e.jsx(V,{}),children:"Reset"})})]}),e.jsx("div",{style:{height:"680px"},children:e.jsx(G,{rowKey:"id",dataSource:M.updated.slice((p.updated-1)*f.updated,p.updated*f.updated),columns:W(L,"Updated",x.updated),bordered:!0,pagination:!1,onChange:(t,a,n)=>H("updated",t,a,n),scroll:{x:"max-content",y:620},loading:l})}),e.jsxs("div",{className:"flex items-center justify-between mt-5",children:[e.jsxs(Y.Text,{style:{color:"#072C1C"},children:["Showing ",(u.updated?c.updated:v).length>0?(p.updated-1)*f.updated+1:0," to"," ",Math.min(p.updated*f.updated,(u.updated?c.updated:v).length),"of ",(u.updated?c.updated:v).length," entries"]}),e.jsx(J,{current:p.updated,pageSize:f.updated,total:(u.updated?c.updated:v).length,showSizeChanger:!0,pageSizeOptions:["10","20","30"],onChange:(t,a)=>O("updated",t,a)})]})]})},{key:"3",label:"Deleted",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex mb-4",children:[e.jsx(U,{menu:E("deleted"),trigger:["click"],children:e.jsx(k,{type:"text",className:"bg-[#a7f3d0] border-black",icon:e.jsx(q,{}),children:e.jsxs(P,{children:[((se=D.find(t=>t.key===j.deleted))==null?void 0:se.label)||"All Columns",e.jsx(T,{})]})})}),e.jsx(K,{placeholder:`Search in ${j.deleted==="all"?"all columns":(re=D.find(t=>t.key===j.deleted))==null?void 0:re.label}`,prefix:e.jsx(Q,{style:{color:"black"}}),value:x.deleted,onChange:t=>$("deleted",t),className:"bg-transparent custom-input-history custom-input-table w-64 border-r-black border-b-black border-t-black",suffix:x.deleted?e.jsx(k,{type:"text",size:"small",onClick:()=>_("deleted"),children:"Ã—"}):null}),e.jsx("div",{className:"ml-2",children:e.jsx(k,{onClick:()=>B("deleted"),className:"custom-button",type:"default",size:"small",icon:e.jsx(V,{}),children:"Reset"})})]}),e.jsx("div",{style:{height:"680px"},children:e.jsx(G,{rowKey:"id",dataSource:M.deleted.slice((p.deleted-1)*f.deleted,p.deleted*f.deleted),columns:W(L,"Deleted",x.deleted),bordered:!0,pagination:!1,onChange:(t,a,n)=>H("deleted",t,a,n),scroll:{x:"max-content",y:620},loading:l})}),e.jsxs("div",{className:"flex items-center justify-between mt-5",children:[e.jsxs(Y.Text,{style:{color:"#072C1C"},children:["Showing ",(u.deleted?c.deleted:I).length>0?(p.deleted-1)*f.deleted+1:0," to"," ",Math.min(p.deleted*f.deleted,(u.deleted?c.deleted:I).length),"of ",(u.deleted?c.deleted:I).length," entries"]}),e.jsx(J,{current:p.deleted,pageSize:f.deleted,total:(u.deleted?c.deleted:I).length,showSizeChanger:!0,pageSizeOptions:["10","20","30"],onChange:(t,a)=>O("deleted",t,a)})]})]})}]}),e.jsx(Ce,{visible:d,onClose:()=>g(!1),record:F})]})},Ne=()=>e.jsx("div",{className:"flex flex-col w-full h-auto p-8",children:e.jsx("div",{className:"mt-5",children:e.jsx(we,{})})});export{Ne as default};
