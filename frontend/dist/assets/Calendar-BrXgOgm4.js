import{ar as Y,as as A,j as e,aq as g,bR as B,bS as k,a5 as D,av as S,bT as w,s as j,an as E,ao as R,f as P,d as M,bU as T,r as F,au as $,at as I,bV as O,bW as G,T as q}from"./index-CXzfmlPR.js";import{R as L}from"./PlusOutlined-CG85mdBA.js";import{T as x}from"./index-DFFp316Q.js";const _=({currentDate:c,info:d,events:o,showModal:m,isAdmin:i,currentUser:a,setEvents:f,isGuest:u})=>{const{logUserActivity:n}=Y(),{logUserNotification:v}=A();if(d.type==="date"){const t=c.format("YYYY-MM-DD"),y=o[t]||[],r=s=>{w(s.id).then(l=>{l.success?(f(p=>{const N={...p},b=N[t].filter(C=>C.id!==s.id);return N[t]=b,N}),j.success("Event deleted successfully!"),n((a==null?void 0:a.username)||"Unknown User","Event",`Deleted an event: "${s.content}"`),v("Event Deleted",`Deleted an event: "${s.content}"`)):j.error(l.message||"Failed to delete event")}).catch(l=>{console.error("Failed to delete event:",l),j.error("Error deleting event. Please try again.")})};return e.jsxs("ul",{className:"events",children:[y.map(s=>e.jsxs("li",{children:[e.jsx(g,{title:s.username,children:e.jsx(B,{src:s.avatar})}),e.jsx(k,{color:s.type,text:e.jsx("span",{style:{color:s.type},children:s.content})}),(i||s.username===(a==null?void 0:a.username))&&e.jsx(g,{title:"Delete Event",children:e.jsx(D,{type:"link",danger:!0,icon:e.jsx(S,{}),style:{padding:0},onClick:()=>r(s)})})]},s.id)),!u&&e.jsx(g,{title:"Add Event",children:e.jsx(D,{type:"link",icon:e.jsx(L,{}),onClick:()=>m(c),style:{padding:0}})})]})}return null},{Option:h}=M,K=({isOpen:c,onClose:d,selectedDate:o,loadEvents:m})=>{const[i]=E.useForm(),{logUserActivity:a}=Y(),{logUserNotification:f}=A(),u=()=>{i.validateFields().then(n=>{const v={date:o.format("YYYY-MM-DD"),content:n.event,event_type:n.color};T(v).then(t=>{t.success?(j.success("Event added successfully!"),i.resetFields(),m(),d(),a(t.username,"Event",`Added an event: "${n.event}"`),f("New event scheduled!",`Your upcoming event "${n.event}" is scheduled for ${o.format("YYYY-MM-DD")}.`)):j.error(t.message||"Failed to add event.")}).catch(t=>{j.error("Failed to add event."),console.error("Failed to add event:",t)})})};return e.jsx(R,{title:`Add Event on ${o?o.format("YYYY-MM-DD"):""}`,open:c,onOk:u,onCancel:d,children:e.jsxs(E,{form:i,layout:"vertical",children:[e.jsx(E.Item,{name:"event",label:"Event Description",rules:[{required:!0,message:"Please input the event description!"}],children:e.jsx(P,{})}),e.jsx(E.Item,{name:"color",label:"Event Color",rules:[{required:!0,message:"Please select a color for the event!"}],children:e.jsxs(M,{placeholder:"Select a category",allowClear:!0,children:[e.jsx(h,{value:"#4169E1",children:"Important (Royal Blue)"}),e.jsx(h,{value:"#FFD700",children:"Celebration (Gold)"}),e.jsx(h,{value:"#228B22",children:"Task (Forest Green)"}),e.jsx(h,{value:"#4682B4",children:"Meeting (Steel Blue)"}),e.jsx(h,{value:"#FFC0CB",children:"Personal (Soft Pink)"}),e.jsx(h,{value:"#B22222",children:"Deadline (Firebrick Red)"}),e.jsx(h,{value:"#FFFFE0",children:"Idea (Pale Yellow)"})]})})]})})},{Title:V}=q,J=()=>{const[c,d]=F.useState({}),[o,m]=F.useState(!1),[i,a]=F.useState(null),{userData:f}=$(),{userData:u}=I(),n=!!u,v=f||u;F.useEffect(()=>{t()},[]);const t=()=>{O().then(r=>{const s={};r.forEach(l=>{const p=l.event_date;s[p]||(s[p]=[]),s[p].push({id:l.id,type:l.event_type,content:l.content,avatar:l.avatar||"",username:l.username||""})}),d(s)}).catch(r=>{console.error("Failed to fetch events:",r)})},y=r=>{a(r),m(!0)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col w-full p-8",children:[e.jsx("div",{className:"mb-5",children:e.jsx(V,{level:3,children:"CALENDAR"})}),e.jsxs("div",{className:"flex flex-wrap justify-center mb-5",children:[e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#4169E1",children:"Important"}),e.jsx("span",{className:"ml-2",children:"Royal Blue"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#FFD700",children:"Celebration"}),e.jsx("span",{className:"ml-2",children:"Gold"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#228B22",children:"Task"}),e.jsx("span",{className:"ml-2",children:"Forest Green"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#4682B4",children:"Meeting"}),e.jsx("span",{className:"ml-2",children:"Steel Blue"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#FFC0CB",children:"Personal"}),e.jsx("span",{className:"ml-2",children:"Soft Pink"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#B22222",children:"Deadline"}),e.jsx("span",{className:"ml-2",children:"Firebrick Red"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#FFFFE0",children:"Idea"}),e.jsx("span",{className:"ml-2",children:"Pale Yellow"})]})]}),e.jsxs("div",{className:"flex flex-col w-full h-auto mx-auto bg-[#A8E1C5] rounded-xl shadow p-2",children:[e.jsx(G,{cellRender:(r,s)=>e.jsx(_,{currentDate:r,info:s,events:c,showModal:y,isAdmin:n,currentUser:v,setEvents:d,isGuest:!n&&!v})}),e.jsx(K,{isOpen:o,onClose:()=>m(!1),selectedDate:i,loadEvents:t,events:c})]})]})})};export{J as default};
