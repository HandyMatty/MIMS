import{R as L,r as u,ar as z,as as G,at as F,au as $,j as t,a5 as p,b as U,f as B,h as M,d as j,ax as V,T as W,e as H}from"./index-CXzfmlPR.js";import{C as k}from"./index-CC7Ff95b.js";import{D as v}from"./index-BqtpGqCk.js";import{a as X,Q as Y}from"./QrCodeModal-qo3y8DWi.js";import{g as _}from"./addItemToInventory-CZblZqRk.js";import{T as A}from"./index-DFFp316Q.js";import{F as J}from"./Table-C__1O1gZ.js";import"./PlusOutlined-CG85mdBA.js";import"./addEventListener-CLfSFitR.js";const K=a=>{const e=a.current.querySelector("svg");if(e){const n=new XMLSerializer().serializeToString(e),d=new Image,i=new Blob([n],{type:"image/svg+xml;charset=utf-8"}),x=URL.createObjectURL(i);d.onload=()=>{const o=document.createElement("canvas");o.width=250,o.height=250,o.getContext("2d").drawImage(d,0,0);const c=document.createElement("a");c.download="qrcode.png",c.href=o.toDataURL("image/png"),c.click(),URL.revokeObjectURL(x)},d.src=x}},Z=a=>{const e=a.current.querySelector("svg");if(e){const n=new XMLSerializer().serializeToString(e),d=new Blob([n],{type:"image/svg+xml"}),i=document.createElement("a");i.download="qrcode.svg",i.href=URL.createObjectURL(d),i.click()}},ee=(a,e=250)=>{const r=window.open("","_blank");if(r){const n=a.current.innerHTML,d=`
        <style>
          body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
          }
          div {
            width: ${e}px;
            height: ${e}px;
          }
          svg, canvas {
            width: 100% !important;
            height: 100% !important;
          }
        </style>
      `;r.document.write(`
        <html>
          <head>
            <title>Print QR Code</title>
            ${d}
          </head>
          <body>
            <div>${n}</div>
          </body>
        </html>
      `),r.document.close(),r.focus(),setTimeout(()=>r.print(),500)}},te=({itemDetails:a})=>{const[e,r]=L.useState("PNG"),n=u.useRef(null),{logUserActivity:d}=z(),{logUserNotification:i}=G(),{userData:x}=F(),{userData:o}=$(),m=(x==null?void 0:x.username)||(o==null?void 0:o.username)||"Unknown User",c=x||o,g=a?{id:a.id||"N/A",Type:a.type||"N/A",Brand:a.brand||"N/A",remarks:a.remarks||"N/A",quantity:a.quantity||"N/A","Serial Number":a.serialNumber||"N/A","Issued Date":a.issuedDate||"N/A","Purchased Date":a.purchaseDate||"N/A",Condition:a.condition||"N/A",Location:a.location||"N/A",Status:a.status||"N/A"}:{id:"N/A",Type:"N/A",Brand:"N/A",quantity:"N/A",remarks:"N/A","Serial Number":"N/A","Issued Date":"N/A","Purchased Date":"N/A",Condition:"N/A",Location:"N/A",Status:"N/A"},y=l=>{l==="PNG"?K(n):Z(n),d(m,"Download QR Code",`Downloaded QR code in ${l} format`),i("Downloaded QR CODE",`You successfully downloaded QR code in ${l} format`)},f=()=>{ee(n),d(m,"Print QR Code",`Printed QR code for item with serial number: ${a.serialNumber}`),i("Printed QR CODE",`You successfully printed QR code for item with serial number: ${a.serialNumber}`)};return t.jsx(k,{title:t.jsx("span",{className:"text-5xl-6 font-bold flex justify-center",children:"DETAILS"}),className:"flex flex-col w-full mx-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:t.jsxs("div",{className:"flex flex-row justify-between gap-8",children:[t.jsx("div",{className:"w-1/2 space-y-4",style:{maxWidth:"50%"},children:t.jsx("div",{className:"p-4 rounded-lg bg-[#A8E1C5] shadow",style:{border:"1px solid #072C1C",borderRadius:"8px"},children:t.jsx(v,{title:t.jsx("div",{style:{textAlign:"center",fontWeight:"bold",fontSize:"18px"},children:"Latest Item Info"}),bordered:!0,column:1,size:"small",labelStyle:{fontWeight:"bold",color:"#072C1C",width:"120px"},contentStyle:{color:"#072C1C"},children:Object.entries(g).filter(([l])=>!(l==="quantity"&&g["Serial Number"]!=="N/A")).map(([l,w])=>t.jsx(v.Item,{label:l,children:w},l))})})}),t.jsxs("div",{className:"w-1/2 flex flex-col items-center space-y-4",children:[t.jsx("div",{ref:n,style:{display:"inline-block",border:"1px solid #072C1C",borderRadius:"8px",padding:"0",width:"250px",height:"250px"},children:t.jsx(X,{value:JSON.stringify(Object.fromEntries(Object.entries(a||{}).filter(([l])=>!(l==="quantity"&&(a!=null&&a.serialNumber))))),type:"svg",style:{width:"100%",height:"100%",border:"none"}})}),t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"font-bold text-sm text-[#072C1C] mb-2",children:"Image format:"}),t.jsxs(p.Group,{children:[t.jsx(p,{type:"primary",onClick:()=>r("PNG"),className:`text-black ${e==="PNG"?"bg-lime-200":"bg-[#EAF4E2]"}`,disabled:!c,children:"PNG"}),t.jsx(p,{type:"primary",onClick:()=>r("SVG"),className:`text-black ${e==="SVG"?"bg-lime-200":"bg-[#EAF4E2]"}`,disabled:!c,children:"SVG"})]})]}),t.jsxs(p,{onClick:()=>y(e),className:"bg-lime-200 shadow-md text-[#072C1C] text-lg",type:"primary",style:{width:"100%",maxWidth:"177px",height:"31px"},disabled:!c,children:["Download ",e]}),t.jsx(p,{onClick:f,className:"bg-lime-200 shadow-md text-[#072C1C] text-lg",type:"primary",style:{width:"100%",maxWidth:"177px",height:"31px"},disabled:!c,children:"Print QR Code"})]})]})})},ae=a=>{let e;switch(a){case"On Stock":e="green";break;case"For Repair":e="volcano";break;case"Deployed":e="blue";break;default:e="gray"}return t.jsx(A,{color:e,children:a})},re=a=>{let e;switch(a){case"Brand New":e="gold";break;case"Good Condition":e="green";break;case"Defective":e="red";break;default:e="gray"}return t.jsx(A,{color:e,children:a})},se=a=>[{title:"QR Code",dataIndex:"qrCode",key:"qrCode",align:"center",ellipsis:!0,fixed:"left",width:80,render:(e,r)=>t.jsx(U,{style:{fontSize:"24px",cursor:"pointer"},onClick:()=>a(r),title:"Generate QR Code"})},{title:"ID",dataIndex:"id",key:"id",align:"center",fixed:"left",width:130,sorter:(e,r)=>e.id.localeCompare(r.id)},{title:"Type",dataIndex:"type",key:"type",align:"center",fixed:"left",width:120,sorter:(e,r)=>e.type.localeCompare(r.type)},{title:"Brand",dataIndex:"brand",key:"brand",align:"center",sorter:(e,r)=>e.brand.localeCompare(r.brand)},{title:"Qty",dataIndex:"quantity",key:"quantity",align:"center",width:100,sorter:(e,r)=>e.quantity-r.quantity},{title:"Remarks",dataIndex:"remarks",key:"remarks",align:"center",width:200,render:e=>e&&e.trim()!==""?e:"-"},{title:"Serial Number",dataIndex:"serialNumber",key:"serialNumber",align:"center",sorter:(e,r)=>e.serialNumber.localeCompare(r.serialNumber),render:e=>e&&e.trim()!==""?e:"-"},{title:"Issued Date",dataIndex:"issuedDate",key:"issuedDate",align:"center",sorter:(e,r)=>e.issuedDate.localeCompare(r.issuedDate),render:e=>!e||e==="0000-00-00"?"NO DATE":e},{title:"Purchased Date",dataIndex:"purchaseDate",key:"purchaseDate",align:"center",sorter:(e,r)=>e.purchaseDate.localeCompare(r.purchaseDate)},{title:"Condition",dataIndex:"condition",key:"condition",align:"center",render:e=>re(e),filters:[{text:"Brand New",value:"Brand New"},{text:"Good Condition",value:"Good Condition"},{text:"Defective",value:"Defective"}],onFilter:(e,r)=>r.condition.includes(e)},{title:"Detachment/Office",dataIndex:"location",key:"location",align:"center"},{title:"Status",dataIndex:"status",key:"status",align:"center",render:e=>ae(e),filters:[{text:"On Stock",value:"On Stock"},{text:"For Repair",value:"For Repair"},{text:"Deployed",value:"Deployed"}],onFilter:(e,r)=>r.status.includes(e)}],{Option:S}=j,ne=({onItemSelect:a})=>{const[e,r]=u.useState(""),[n,d]=u.useState("newest"),[i,x]=u.useState(1),[o,m]=u.useState(10),[c,N]=u.useState([]),[g,y]=u.useState(!1),[f,l]=u.useState(null),[w,I]=u.useState(!0);u.useEffect(()=>{(async()=>{try{const h=await _();if(Array.isArray(h)){const C=[...h].sort((P,q)=>q.id-P.id);N(C),C.length>0&&!f&&(a(C[0]),l(C[0]))}else console.error("Received invalid data:",h)}catch(h){console.error("Failed to load inventory data:",h)}finally{I(!1)}})()},[a,f]);const R=[...Array.isArray(c)?c.filter(s=>Object.values(s).join(" ").toLowerCase().includes(e.toLowerCase())):[]].sort((s,h)=>n==="newest"?h.id-s.id:n==="oldest"?s.id-h.id:0),b=c.length,D=s=>{d(s.toLowerCase()),x(1)},Q=(s,h)=>{x(s),m(h)},O=R.slice((i-1)*o,i*o),T=s=>{l(s),y(!0)},E=s=>{a(s),l(s)};return t.jsxs(k,{title:t.jsx("span",{className:"text-5xl-6 font-bold flex justify-center",children:"ITEMS"}),className:"flex flex-col w-full mx-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:[t.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[t.jsx(B,{placeholder:"Search",prefix:t.jsx(M,{}),className:"w-[268px] h-[33.63px] bg-[#a7f3d0] border-black custom-input-table",value:e,onChange:s=>r(s.target.value)}),t.jsxs("div",{className:"flex items-center text-[#072C1C] text-sm font-medium",children:["Sort by:",t.jsxs(j,{defaultValue:"Newest",suffixIcon:t.jsx(V,{}),className:"ml-2 w-[132.94px] transparent-select",onChange:D,children:[t.jsx(S,{value:"newest",children:"Newest"}),t.jsx(S,{value:"oldest",children:"Oldest"})]})]})]}),t.jsx("div",{style:{height:"700px"},children:t.jsx(J,{rowKey:"id",columns:se(T),dataSource:O.map(s=>({...s,key:s.id})),pagination:!1,bordered:!0,onRow:s=>({onClick:()=>E(s)}),scroll:{x:"max-content",y:600},loading:w})}),t.jsxs("div",{className:"flex items-center justify-between mt-5",children:[t.jsxs(W.Text,{style:{color:"#072C1C",fontSize:14},children:["Showing data of ",b>0?(i-1)*o+1:0," to"," ",Math.min(i*o,b)," of ",b," entries"]}),t.jsx(H,{current:i,pageSize:o,total:b,showSizeChanger:!0,pageSizeOptions:["10","20","30"],onChange:Q})]}),t.jsx(Y,{isVisible:g,onClose:()=>y(!1),qrDetails:f})]})},pe=()=>{const[a,e]=u.useState(null),r=n=>{e(n)};return t.jsxs("div",{className:"flex flex-col w-full p-8",children:[t.jsx("div",{children:t.jsx(te,{itemDetails:a})}),t.jsx("div",{className:"mt-5",children:t.jsx(ne,{onItemSelect:r})})]})};export{pe as default};
