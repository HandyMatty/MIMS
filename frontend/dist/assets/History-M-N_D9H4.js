import{aw as P,j as e,a5 as U,ao as L,r as c,f as I,h as _,T as N,e as A}from"./index-CXzfmlPR.js";import{T as O}from"./index-DFFp316Q.js";import{C as q,T as K}from"./index-CC7Ff95b.js";import{F as T}from"./Table-C__1O1gZ.js";import"./PlusOutlined-CG85mdBA.js";import"./addEventListener-CLfSFitR.js";const G=async()=>{try{return(await P.get("/getHistory.php")).data}catch(n){throw console.error("Error fetching history:",n),n}},Q=n=>{const u={"On Stock":"green","For Repair":"volcano",Deployed:"blue"};return e.jsx(O,{color:u[n]||"gray",children:n})},V=n=>{const u={"Brand New":"gold","Good Condition":"green",Defective:"red"};return e.jsx(O,{color:u[n]||"gray",children:n})},z=(n,u)=>{let l=[{title:"ID",dataIndex:"id",key:"id",align:"center",sorter:!0,width:100,fixed:"left"},{title:"Action",dataIndex:"action",key:"action",align:"center",width:150,fixed:"left"},{title:"Action Date",dataIndex:"action_date",key:"action_date",align:"center",sorter:!0,width:180,render:d=>new Date(d).toLocaleDateString(),fixed:"left"},{title:"Item ID",dataIndex:"item_id",key:"item_id",align:"center",sorter:!0,width:120,fixed:"left"}];return(u==="Added"||u==="Deleted")&&l.push({title:"Type",dataIndex:"type",key:"type",align:"center",width:120},{title:"Brand",dataIndex:"brand",key:"brand",align:"center",width:120},{title:"Qty",dataIndex:"quantity",key:"quantity",align:"center",width:100,sorter:(d,o)=>d.quantity-o.quantity},{title:"Remarks",dataIndex:"remarks",key:"remarks",align:"center",width:200,render:d=>d&&d.trim()!==""?d:"-"},{title:"Serial No.",dataIndex:"serial_number",key:"serial_number",align:"center",width:200,render:d=>d&&d.trim()!==""?d:"-"},{title:"Issued Date",dataIndex:"issued_date",key:"issued_date",align:"center",sorter:!0,width:150,render:d=>!d||d==="0000-00-00"?"NO DATE":d},{title:"Purchased Date",dataIndex:"purchase_date",key:"purchase_date",align:"center",sorter:!0,width:150},{title:"Condition",dataIndex:"condition",key:"condition",align:"center",width:150,render:d=>V(d),filters:[{text:"Brand New",value:"Brand New"},{text:"Good Condition",value:"Good Condition"},{text:"Defective",value:"Defective"}],onFilter:(d,o)=>o.condition.includes(d)},{title:"Detachment/Office",dataIndex:"location",key:"location",align:"center",width:150},{title:"Status",dataIndex:"status",key:"status",align:"center",width:120,render:d=>Q(d),filters:[{text:"On Stock",value:"On Stock"},{text:"For Repair",value:"For Repair"},{text:"Deployed",value:"Deployed"}],onFilter:(d,o)=>o.status.includes(d)}),u==="Updated"&&l.push({title:"Field Changed",dataIndex:"field_changed",key:"field_changed",align:"center",width:200,render:d=>d?d.join(", "):"N/A"},{title:"Changed Details",key:"changed_details",align:"center",width:250,render:(d,o)=>e.jsx(U,{type:"link",onClick:()=>n(o),children:"View Changes"})}),l},Y=({visible:n,onClose:u,record:l})=>l?e.jsx(L,{title:"Changed Details",open:n,onCancel:u,footer:null,children:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Item ID:"})," ",l.item_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Action Date:"})," ",new Date(l.action_date).toLocaleString()]}),Array.isArray(l.field_changed)&&l.field_changed.length>0?l.field_changed.map((d,o)=>e.jsxs("div",{children:[e.jsx("p",{children:e.jsxs("strong",{children:[d,":"]})}),e.jsxs("p",{style:{color:"red",textDecoration:"line-through"},children:["Old: ",l.old_value[o]??"N/A"]}),e.jsxs("p",{style:{color:"green"},children:["New: ",l.new_value[o]??"N/A"]}),e.jsx("hr",{})]},o)):e.jsx("p",{children:"No changes recorded."})]})}):null,J=()=>{const[n,u]=c.useState([]),[l,d]=c.useState(!0),[o,F]=c.useState(!1),[R,M]=c.useState(null),[h,S]=c.useState({added:"",updated:"",deleted:""}),[s,H]=c.useState({added:1,updated:1,deleted:1}),[i,E]=c.useState({added:10,updated:10,deleted:10}),[f,B]=c.useState({added:{field:null,order:null},updated:{field:null,order:null},deleted:{field:null,order:null}});c.useEffect(()=>{(async()=>{try{const a=await G();u(a)}catch(a){console.error("Error fetching history data:",a)}finally{d(!1)}})()},[]);const C=(t,a,r)=>{const g=t.filter(w=>Object.values(w).some(b=>b==null?void 0:b.toString().toLowerCase().includes(a.toLowerCase())));return r.field&&r.order?[...g].sort((w,b)=>{const x=w[r.field],p=b[r.field];return r.field==="id"?r.order==="ascend"?x-p:p-x:typeof x=="string"&&typeof p=="string"?r.order==="ascend"?x.localeCompare(p):p.localeCompare(x):r.order==="ascend"?x>p?1:-1:x<p?1:-1}):g},y=c.useMemo(()=>C(n.filter(t=>t.action==="Added"),h.added,f.added),[n,h.added,f.added]),m=c.useMemo(()=>C(n.filter(t=>t.action==="Updated"||t.action==="QRCode Update"),h.updated,f.updated),[n,h.updated,f.updated]),j=c.useMemo(()=>C(n.filter(t=>t.action==="Deleted"),h.deleted,f.deleted),[n,h.deleted,f.deleted]),D=(t,a,r)=>{H(g=>({...g,[t]:a})),E(g=>({...g,[t]:r}))},v=(t,a,r,g)=>{B(w=>({...w,[t]:{field:g.field,order:g.order}}))},k=t=>{M(t),F(!0)};return e.jsxs(q,{title:e.jsx("span",{className:"text-5xl-6 font-bold flex justify-center",children:"HISTORY"}),className:"flex flex-col w-full mx-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:[e.jsx(K,{defaultActiveKey:"1",type:"card",items:[{key:"1",label:"Added",children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between mb-4",children:e.jsx(I,{placeholder:"Search...",prefix:e.jsx(_,{}),onChange:t=>S(a=>({...a,added:t.target.value})),value:h.added,className:"w-64 bg-[#a7f3d0] border border-black custom-input-table"})}),e.jsx("div",{style:{height:"680px"},children:e.jsx(T,{rowKey:"id",dataSource:y.slice((s.added-1)*i.added,s.added*i.added),columns:z(k,"Added"),bordered:!0,pagination:!1,onChange:(t,a,r)=>v("added",t,a,r),scroll:{x:"max-content",y:620},loading:l})}),e.jsxs("div",{className:"flex items-center justify-between mt-5",children:[e.jsxs(N.Text,{style:{color:"#072C1C"},children:["Showing ",y.length>0?(s.added-1)*i.added+1:0," to"," ",Math.min(s.added*i.added,y.length)," of ",y.length," entries"]}),e.jsx(A,{current:s.added,pageSize:i.added,total:y.length,showSizeChanger:!0,pageSizeOptions:["10","20","30"],onChange:(t,a)=>D("added",t,a)})]})]})},{key:"2",label:"Updated / QRCode Update",children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between mb-4",children:e.jsx(I,{placeholder:"Search...",prefix:e.jsx(_,{}),onChange:t=>S(a=>({...a,updated:t.target.value})),value:h.updated,className:"w-64 bg-[#a7f3d0] border border-black custom-input-table"})}),e.jsx("div",{style:{height:"680px"},children:e.jsx(T,{rowKey:"id",dataSource:m.slice((s.updated-1)*i.updated,s.updated*i.updated),columns:z(k,"Updated"),bordered:!0,pagination:!1,onChange:(t,a,r)=>v("updated",t,a,r),scroll:{x:"max-content",y:620},loading:l})}),e.jsxs("div",{className:"flex items-center justify-between mt-5",children:[e.jsxs(N.Text,{style:{color:"#072C1C"},children:["Showing ",m.length>0?(s.updated-1)*i.updated+1:0," to"," ",Math.min(s.updated*i.updated,m.length)," of ",m.length," entries"]}),e.jsx(A,{current:s.updated,pageSize:i.updated,total:m.length,showSizeChanger:!0,pageSizeOptions:["10","20","30"],onChange:(t,a)=>D("updated",t,a)})]})]})},{key:"3",label:"Deleted",children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between mb-4",children:e.jsx(I,{placeholder:"Search...",prefix:e.jsx(_,{}),onChange:t=>S(a=>({...a,deleted:t.target.value})),value:h.deleted,className:"w-64 bg-[#a7f3d0] border border-black custom-input-table"})}),e.jsx("div",{style:{height:"680px"},children:e.jsx(T,{rowKey:"id",dataSource:j.slice((s.deleted-1)*i.deleted,s.deleted*i.deleted),columns:z(k,"Deleted"),bordered:!0,pagination:!1,onChange:(t,a,r)=>v("deleted",t,a,r),scroll:{x:"max-content",y:620},loading:l})}),e.jsxs("div",{className:"flex items-center justify-between mt-5",children:[e.jsxs(N.Text,{style:{color:"#072C1C"},children:["Showing ",j.length>0?(s.deleted-1)*i.deleted+1:0," to"," ",Math.min(s.deleted*i.deleted,j.length)," of ",j.length," entries"]}),e.jsx(A,{current:s.deleted,pageSize:i.deleted,total:j.length,showSizeChanger:!0,pageSizeOptions:["10","20","30"],onChange:(t,a)=>D("deleted",t,a)})]})]})}]}),e.jsx(Y,{visible:o,onClose:()=>F(!1),record:R})]})},de=()=>e.jsx("div",{className:"flex flex-col w-full h-auto p-8",children:e.jsx("div",{className:"mt-5",children:e.jsx(J,{})})});export{de as default};
