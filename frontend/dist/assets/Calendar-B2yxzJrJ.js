import{J as Y,K as M,k as e,ak as g,b2 as B,b3 as C,B as D,aJ as S,aW as w,b4 as P,aS as j,aX as E,M as R,o as $,aY as A,b5 as I,r as F,N as T,L as O,b6 as G,E as L,T as x,b7 as K}from"./index-BY-OqtzB.js";const _=({currentDate:r,info:d,events:o,showModal:m,isAdmin:i,currentUser:n,setEvents:f,isGuest:u})=>{const{logUserActivity:a}=Y(),{logUserNotification:v}=M();if(d.type==="date"){const t=r.format("YYYY-MM-DD"),y=o[t]||[],c=s=>{P(s.id).then(l=>{l.success?(f(p=>{const N={...p},b=N[t].filter(k=>k.id!==s.id);return N[t]=b,N}),j.success("Event deleted successfully!"),a((n==null?void 0:n.username)||"Unknown User","Event",`Deleted an event: "${s.content}"`),v("Event Deleted",`Deleted an event: "${s.content}"`)):j.error(l.message||"Failed to delete event")}).catch(l=>{console.error("Failed to delete event:",l),j.error("Error deleting event. Please try again.")})};return e.jsxs("ul",{className:"events",children:[y.map(s=>e.jsxs("li",{children:[e.jsx(g,{title:s.username,children:e.jsx(B,{src:s.avatar})}),e.jsx(C,{color:s.type,text:e.jsx("span",{style:{color:s.type},children:s.content})}),(i||s.username===(n==null?void 0:n.username))&&e.jsx(g,{title:"Delete Event",children:e.jsx(D,{type:"link",danger:!0,icon:e.jsx(S,{}),style:{padding:0},onClick:()=>c(s)})})]},s.id)),!u&&e.jsx(g,{title:"Add Event",children:e.jsx(D,{type:"link",icon:e.jsx(w,{}),onClick:()=>m(r),style:{padding:0}})})]})}return null},{Option:h}=A,q=({isOpen:r,onClose:d,selectedDate:o,loadEvents:m})=>{const[i]=E.useForm(),{logUserActivity:n}=Y(),{logUserNotification:f}=M(),u=()=>{i.validateFields().then(a=>{const v={date:o.format("YYYY-MM-DD"),content:a.event,event_type:a.color};I(v).then(t=>{t.success?(j.success("Event added successfully!"),i.resetFields(),m(),d(),n(t.username,"Event",`Added an event: "${a.event}"`),f("New event scheduled!",`Your upcoming event "${a.event}" is scheduled for ${o.format("YYYY-MM-DD")}.`)):j.error(t.message||"Failed to add event.")}).catch(t=>{j.error("Failed to add event."),console.error("Failed to add event:",t)})})};return e.jsx(R,{title:`Add Event on ${o?o.format("YYYY-MM-DD"):""}`,open:r,onOk:u,onCancel:d,children:e.jsxs(E,{form:i,layout:"vertical",children:[e.jsx(E.Item,{name:"event",label:"Event Description",rules:[{required:!0,message:"Please input the event description!"}],children:e.jsx($,{})}),e.jsx(E.Item,{name:"color",label:"Event Color",rules:[{required:!0,message:"Please select a color for the event!"}],children:e.jsxs(A,{placeholder:"Select a category",allowClear:!0,children:[e.jsx(h,{value:"#4169E1",children:"Important (Royal Blue)"}),e.jsx(h,{value:"#FFD700",children:"Celebration (Gold)"}),e.jsx(h,{value:"#228B22",children:"Task (Forest Green)"}),e.jsx(h,{value:"#4682B4",children:"Meeting (Steel Blue)"}),e.jsx(h,{value:"#FFC0CB",children:"Personal (Soft Pink)"}),e.jsx(h,{value:"#B22222",children:"Deadline (Firebrick Red)"}),e.jsx(h,{value:"#FFFFE0",children:"Idea (Pale Yellow)"})]})})]})})},{Title:J}=L,X=()=>{const[r,d]=F.useState({}),[o,m]=F.useState(!1),[i,n]=F.useState(null),{userData:f}=T(),{userData:u}=O(),a=!!u,v=f||u;F.useEffect(()=>{t()},[]);const t=()=>{G().then(c=>{const s={};c.forEach(l=>{const p=l.event_date;s[p]||(s[p]=[]),s[p].push({id:l.id,type:l.event_type,content:l.content,avatar:l.avatar||"",username:l.username||""})}),d(s)}).catch(c=>{console.error("Failed to fetch events:",c)})},y=c=>{n(c),m(!0)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col w-full p-8",children:[e.jsx("div",{className:"mb-5",children:e.jsx(J,{level:3,children:"CALENDAR"})}),e.jsxs("div",{className:"flex flex-wrap justify-center mb-5",children:[e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#4169E1",children:"Important"}),e.jsx("span",{className:"ml-2",children:"Royal Blue"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#FFD700",children:"Celebration"}),e.jsx("span",{className:"ml-2",children:"Gold"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#228B22",children:"Task"}),e.jsx("span",{className:"ml-2",children:"Forest Green"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#4682B4",children:"Meeting"}),e.jsx("span",{className:"ml-2",children:"Steel Blue"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#FFC0CB",children:"Personal"}),e.jsx("span",{className:"ml-2",children:"Soft Pink"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#B22222",children:"Deadline"}),e.jsx("span",{className:"ml-2",children:"Firebrick Red"})]}),e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(x,{color:"#FFFFE0",children:"Idea"}),e.jsx("span",{className:"ml-2",children:"Pale Yellow"})]})]}),e.jsxs("div",{className:"flex flex-col w-full h-auto mx-auto bg-[#A8E1C5] rounded-xl shadow p-2",children:[e.jsx(K,{cellRender:(c,s)=>e.jsx(_,{currentDate:c,info:s,events:r,showModal:y,isAdmin:a,currentUser:v,setEvents:d,isGuest:!a&&!v})}),e.jsx(q,{isOpen:o,onClose:()=>m(!1),selectedDate:i,loadEvents:t,events:r})]})]})})};export{X as default};
