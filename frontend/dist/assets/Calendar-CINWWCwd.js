import{L as Y,N as k,k as e,am as D,bf as B,bg as w,B as C,a_ as S,b7 as R,bh as P,b4 as m,b9 as F,M as $,p as I,b8 as M,bi as O,r as y,Q as T,O as z,bj as G,b5 as L,J as _,m as q,C as x,T as h,bk as K}from"./index-DUYyvjBV.js";const J=({currentDate:c,info:d,events:r,showModal:j,isAdmin:i,currentUser:l,setEvents:f,isGuest:v})=>{const{logUserActivity:a}=Y(),{logUserNotification:p}=k();if(d.type==="date"){const t=c.format("YYYY-MM-DD"),g=r[t]||[],o=s=>{P(s.id).then(n=>{n.success?(f(E=>{const b={...E},A=b[t].filter(N=>N.id!==s.id);return b[t]=A,b}),m.success("Event deleted successfully!"),a((l==null?void 0:l.username)||"Unknown User","Event",`Deleted an event: "${s.content}"`),p("Event Deleted",`Deleted an event: "${s.content}"`)):m.error(n.message||"Failed to delete event")}).catch(n=>{console.error("Failed to delete event:",n),m.error("Error deleting event. Please try again.")})};return e.jsxs("ul",{className:"events",children:[g.map(s=>e.jsxs("li",{children:[e.jsx(D,{title:s.username,className:"size-3 sm:size-5",children:e.jsx(B,{src:s.avatar})}),e.jsx(w,{color:s.type,text:e.jsx("span",{style:{color:s.type},className:"text-xxs sm:text-xs",children:s.content})}),(i||s.username===(l==null?void 0:l.username))&&e.jsx(D,{title:"Delete Event",children:e.jsx(C,{className:"size-1",size:"small",type:"link",danger:!0,icon:e.jsx(S,{}),style:{padding:0},onClick:()=>o(s)})})]},s.id)),!v&&e.jsx(D,{title:"Add Event",children:e.jsx(C,{className:"size-1",size:"small",type:"link",icon:e.jsx(R,{}),onClick:()=>j(c),style:{padding:0}})})]})}return null},{Option:u}=M,Q=({isOpen:c,onClose:d,selectedDate:r,loadEvents:j})=>{const[i]=F.useForm(),{logUserActivity:l}=Y(),{logUserNotification:f}=k(),v=()=>{i.validateFields().then(a=>{const p={date:r.format("YYYY-MM-DD"),content:a.event,event_type:a.color};O(p).then(t=>{t.success?(m.success("Event added successfully!"),i.resetFields(),j(),d(),l(t.username,"Event",`Added an event: "${a.event}"`),f("New event scheduled!",`Your upcoming event "${a.event}" is scheduled for ${r.format("YYYY-MM-DD")}.`)):m.error(t.message||"Failed to add event.")}).catch(t=>{m.error("Failed to add event."),console.error("Failed to add event:",t)})})};return e.jsx($,{title:`Add Event on ${r?r.format("YYYY-MM-DD"):""}`,open:c,onOk:v,onCancel:d,centered:!0,children:e.jsxs(F,{form:i,layout:"vertical",children:[e.jsx(F.Item,{name:"event",label:"Event Description",rules:[{required:!0,message:"Please input the event description!"}],children:e.jsx(I,{})}),e.jsx(F.Item,{name:"color",label:"Event Color",rules:[{required:!0,message:"Please select a color for the event!"}],children:e.jsxs(M,{placeholder:"Select a category",allowClear:!0,children:[e.jsx(u,{value:"#4169E1",children:"Important (Royal Blue)"}),e.jsx(u,{value:"#FFD700",children:"Celebration (Gold)"}),e.jsx(u,{value:"#228B22",children:"Task (Forest Green)"}),e.jsx(u,{value:"#4682B4",children:"Meeting (Steel Blue)"}),e.jsx(u,{value:"#FFC0CB",children:"Personal (Soft Pink)"}),e.jsx(u,{value:"#B22222",children:"Deadline (Firebrick Red)"}),e.jsx(u,{value:"#FFFFE0",children:"Idea (Pale Yellow)"})]})})]})})},{Title:H}=_,W=()=>{const[c,d]=y.useState({}),[r,j]=y.useState(!1),[i,l]=y.useState(null),{userData:f}=T(),{userData:v}=z(),a=!!v,p=f||v;y.useEffect(()=>{t()},[]);const t=()=>{G().then(o=>{const s={};o.forEach(n=>{const E=n.event_date;s[E]||(s[E]=[]),s[E].push({id:n.id,type:n.event_type,content:n.content,avatar:n.avatar||"",username:n.username||""})}),d(s)}).catch(o=>{console.error("Failed to fetch events:",o)})},g=o=>{l(o),j(!0)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container max-w-full",children:[e.jsx("div",{className:"mt-5",children:e.jsxs(L,{style:{borderColor:"#072C1C"},children:[e.jsx(H,{level:3,children:"CALENDAR"})," "]})}),e.jsxs(q,{className:"flex flex-col sm:flex-row justify-center items-center gap-4 mb-2",children:[e.jsxs(x,{span:[2,2],children:[e.jsx(h,{color:"#4169E1",children:"Important"}),e.jsx("span",{children:"Royal Blue"})]}),e.jsxs(x,{span:[2,2],children:[e.jsx(h,{color:"#FFD700",style:{color:"black"},children:"Celebration"}),e.jsx("span",{children:"Gold"})]}),e.jsxs(x,{span:[2,2],children:[e.jsx(h,{color:"#228B22",children:"Task"}),e.jsx("span",{children:"Forest Green"})]}),e.jsxs(x,{span:[2,2],children:[e.jsx(h,{color:"#4682B4",children:"Meeting"}),e.jsx("span",{children:"Steel Blue"})]}),e.jsxs(x,{span:[2,2],children:[e.jsx(h,{color:"#FFC0CB",style:{color:"black"},children:"Personal"}),e.jsx("span",{children:"Soft Pink"})]}),e.jsxs(x,{span:[2,2],children:[e.jsx(h,{color:"#B22222",children:"Deadline"}),e.jsx("span",{children:"Firebrick Red"})]}),e.jsxs(x,{span:[2,2],children:[e.jsx(h,{color:"#FFFFE0",style:{color:"black"},children:"Idea"}),e.jsx("span",{children:"Pale Yellow"})]})]}),e.jsxs("div",{className:"flex flex-col w-full h-auto mx-auto bg-[#A8E1C5] rounded-xl shadow p-2",children:[e.jsx(K,{className:"text-xs w-full",cellRender:(o,s)=>e.jsx(J,{currentDate:o,info:s,events:c,showModal:g,isAdmin:a,currentUser:p,setEvents:d,isGuest:!a&&!p})}),e.jsx(Q,{isOpen:r,onClose:()=>j(!1),selectedDate:i,loadEvents:t,events:c})]})]})})};export{W as default};
