import{k as e,H as g,B as D,T as de,M as se,t as ae,r as j,u as le,v as ne,n as ie,w as re,x as U,y as V,z as K,E as G,p as Y,q as J,F as W,G as X,J as Z,K as ee}from"./index-DUYyvjBV.js";const oe=n=>{const f={"On Stock":"green","For Repair":"volcano",Deployed:"blue"};return e.jsx(de,{color:f[n]||"gray",children:n})},ce=n=>{const f={"Brand New":"gold","Good Condition":"green",Defective:"red"};return e.jsx(de,{color:f[n]||"gray",children:n})},te=(n,f,l="")=>{let S=[{title:"ID",dataIndex:"id",key:"id",align:"center",sorter:!0,width:"auto",className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d,searchTerm:l})},{title:"Action",dataIndex:"action",key:"action",align:"center",width:"auto",className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d,searchTerm:l})},{title:"Action Date",dataIndex:"action_date",key:"action_date",align:"center",sorter:!0,width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>{if(!d||d==="0000-00-00"||d==="")return e.jsx(g,{text:"NO DATE",searchTerm:l});const r=new Date(d),i=`${r.getMonth()+1}/${r.getDate()}/${r.getFullYear()}`;return e.jsx(g,{text:i,searchTerm:l})}},{title:"Item ID",dataIndex:"item_id",key:"item_id",align:"center",sorter:!0,width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d,searchTerm:l})}];return(f==="Added"||f==="Deleted")&&S.push({title:"Type",dataIndex:"type",key:"type",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d,searchTerm:l})},{title:"Brand",dataIndex:"brand",key:"brand",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d,searchTerm:l})},{title:"Qty",dataIndex:"quantity",key:"quantity",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",sorter:(d,r)=>d.quantity-r.quantity,render:d=>e.jsx(g,{text:d,searchTerm:l})},{title:"Remarks",dataIndex:"remarks",key:"remarks",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d&&d.trim()!==""?d:"-",searchTerm:l})},{title:"Serial No.",dataIndex:"serial_number",key:"serial_number",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d&&d.trim()!==""?d:"-",searchTerm:l})},{title:"Issued Date",dataIndex:"issued_date",key:"issued_date",align:"center",sorter:!0,width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:!d||d==="0000-00-00"?"NO DATE":d,searchTerm:l})},{title:"Purchased Date",dataIndex:"purchase_date",key:"purchase_date",align:"center",sorter:!0,width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d,searchTerm:l})},{title:"Condition",dataIndex:"condition",key:"condition",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>ce(d),filters:[{text:"Brand New",value:"Brand New"},{text:"Good Condition",value:"Good Condition"},{text:"Defective",value:"Defective"}],onFilter:(d,r)=>r.condition.includes(d)},{title:"Detachment/Office",dataIndex:"location",key:"location",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d,searchTerm:l})},{title:"Status",dataIndex:"status",key:"status",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>oe(d),filters:[{text:"On Stock",value:"On Stock"},{text:"For Repair",value:"For Repair"},{text:"Deployed",value:"Deployed"}],onFilter:(d,r)=>r.status.includes(d)}),f==="Updated"&&S.push({title:"Field Changed",dataIndex:"field_changed",key:"field_changed",align:"center",width:"auto",responsive:["sm"],className:"text-xs overflow-auto text-wrap",render:d=>e.jsx(g,{text:d?d.join(", "):"N/A",searchTerm:l})},{title:"Changed Details",key:"changed_details",align:"center",width:"auto",className:"text-xs overflow-auto text-wrap",render:(d,r)=>e.jsx(D,{type:"link",onClick:()=>n(r),className:"text-xs",children:"View Changes"})}),S},xe=({visible:n,onClose:f,record:l})=>l?e.jsx(se,{title:"Changed Details",open:n,onCancel:f,footer:null,centered:!0,children:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Item ID:"})," ",l.item_id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Action Date:"})," ",new Date(l.action_date).toLocaleString()]}),Array.isArray(l.field_changed)&&l.field_changed.length>0?l.field_changed.map((S,d)=>e.jsxs("div",{children:[e.jsx("p",{children:e.jsxs("strong",{children:[S,":"]})}),e.jsxs("p",{style:{color:"red",textDecoration:"line-through"},children:["Old: ",l.old_value[d]??"N/A"]}),e.jsxs("p",{style:{color:"green"},children:["New: ",l.new_value[d]??"N/A"]}),e.jsx("hr",{})]},d)):e.jsx("p",{children:"No changes recorded."})]})}):null,ue=async()=>{try{return(await ae.get("/getHistory.php")).data}catch(n){throw console.error("Error fetching history:",n),n}},he=()=>{const[n,f]=j.useState([]),[l,S]=j.useState(!0),[d,r]=j.useState(!1),[i,o]=j.useState(null),[h,p]=j.useState({added:"",updated:"",deleted:""}),[m,k]=j.useState({added:1,updated:1,deleted:1}),[A,R]=j.useState({added:10,updated:10,deleted:10}),[y,L]=j.useState({added:{field:null,order:null},updated:{field:null,order:null},deleted:{field:null,order:null}}),Q=le({maxWidth:639}),[b,O]=j.useState({added:"all",updated:"all",deleted:"all"}),[H,F]=j.useState({added:[],updated:[],deleted:[]}),[B,M]=j.useState({added:!1,updated:!1,deleted:!1}),E=[{key:"all",label:"All Columns"},{key:"id",label:"ID"},{key:"action",label:"Action"},{key:"action_date",label:"Action Date"},{key:"item_id",label:"Item ID"},{key:"type",label:"Type"},{key:"brand",label:"Brand"},{key:"quantity",label:"Quantity"},{key:"field_changed",label:"Field Changed"},{key:"serial_number",label:"Serial Number"},{key:"location",label:"Location"},{key:"status",label:"Status"},{key:"condition",label:"Condition"}];j.useEffect(()=>{(async()=>{try{const a=await ue();f(a)}catch(a){console.error("Error fetching history data:",a)}finally{S(!1)}})()},[]);const _=j.useCallback((s,a,u,C)=>{let z=s;return a&&(z=s.filter(c=>{if(C==="all")return Object.values(c).some(v=>v==null?void 0:v.toString().toLowerCase().includes(a.toLowerCase()));{const v=c[C];return v&&String(v).toLowerCase().includes(a.toLowerCase())}})),u.field&&u.order?[...z].sort((c,v)=>{const w=c[u.field],N=v[u.field];return u.field==="id"?u.order==="ascend"?w-N:N-w:typeof w=="string"&&typeof N=="string"?u.order==="ascend"?w.localeCompare(N):N.localeCompare(w):u.order==="ascend"?w>N?1:-1:w<N?1:-1}):z},[]),P=j.useMemo(()=>_(n.filter(s=>s.action==="Added"),h.added,y.added,b.added),[n,h.added,y.added,b.added,_]),T=j.useMemo(()=>_(n.filter(s=>s.action==="Updated"||s.action==="QRCode Update"),h.updated,y.updated,b.updated),[n,h.updated,y.updated,b.updated,_]),q=j.useMemo(()=>_(n.filter(s=>s.action==="Deleted"),h.deleted,y.deleted,b.deleted),[n,h.deleted,y.deleted,b.deleted,_]),$=j.useMemo(()=>ne((s,a)=>{F(u=>({...u,[s]:a}))},300),[]),t=(s,a)=>{const u=a.target.value.trim().toLowerCase();if(p(c=>({...c,[s]:u})),u===""){M(c=>({...c,[s]:!1})),F(c=>({...c,[s]:[]}));return}M(c=>({...c,[s]:!0}));const z=n.filter(c=>s==="added"?c.action==="Added":s==="updated"?c.action==="Updated"||c.action==="QRCode Update":s==="deleted"?c.action==="Deleted":!1).filter(c=>{if(!c)return!1;const v=b[s];if(v==="all"){for(const w in c){const N=c[w];if(N&&String(N).toLowerCase().includes(u))return!0}return!1}else{const w=c[v];return w&&String(w).toLowerCase().includes(u)}});$(s,z)},x=(s,a)=>{O(u=>({...u,[s]:a}))},I=s=>{p(a=>({...a,[s]:""})),O(a=>({...a,[s]:"all"})),M(a=>({...a,[s]:!1})),k(a=>({...a,[s]:1})),F(a=>({...a,[s]:[]}))};return{isMobile:Q,historyData:n,loading:l,modalVisible:d,setModalVisible:r,selectedRecord:i,searchTerms:h,currentPages:m,pageSizes:A,sorterConfigs:y,searchColumns:b,localFilteredData:H,filterActive:B,searchableColumns:E,addedData:P,updatedData:T,deletedData:q,handleSearch:t,handleColumnChange:x,resetTab:I,handlePageChange:(s,a,u)=>{k(C=>({...C,[s]:a})),R(C=>({...C,[s]:u}))},handleTableChange:(s,a,u,C)=>{L(z=>({...z,[s]:{field:C.field,order:C.order}}))},showModal:s=>{o(s),r(!0)},resetAllFilters:s=>{I(s),L(a=>({...a,[s]:{field:null,order:null}}))}}},pe=()=>{var E,_,P,T,q,$;const{loading:n,isMobile:f,modalVisible:l,setModalVisible:S,selectedRecord:d,searchTerms:r,currentPages:i,pageSizes:o,searchColumns:h,localFilteredData:p,filterActive:m,searchableColumns:k,addedData:A,updatedData:R,deletedData:y,handleSearch:L,handleColumnChange:Q,resetTab:b,handlePageChange:O,handleTableChange:H,showModal:F,resetAllFilters:B}=he(),M=t=>({items:k.map(x=>({key:x.key,label:x.label})),onClick:({key:x})=>Q(t,x),selectedKeys:[h[t]]});return e.jsxs(ie,{title:e.jsx("span",{className:"text-lgi sm:text-sm md:text-base lg:text-lgi xl:text-xl font-bold flex justify-center",children:"HISTORY"}),className:"flex flex-col w-full mx-auto bg-[#A8E1C5] rounded-xl shadow border-none",children:[e.jsx(re,{defaultActiveKey:"1",type:"card",items:[{key:"1",label:"Added",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-4",children:[e.jsx(U,{menu:M("added"),trigger:["click"],children:e.jsx(D,{type:"text",className:"border-black bg-[#a7f3d0] text-xs sm:block hidden",icon:e.jsx(G,{}),children:e.jsxs(V,{children:[((E=k.find(t=>t.key===h.added))==null?void 0:E.label)||"All Columns",e.jsx(K,{})]})})}),e.jsx(Y,{placeholder:`Search in ${h.added==="all"?"all columns":(_=k.find(t=>t.key===h.added))==null?void 0:_.label}`,prefix:e.jsx(J,{style:{color:"black"}}),value:r.added,onChange:t=>L("added",t),className:"border border-black w-auto ml-1 text-xs",suffix:r.added?e.jsx(D,{type:"text",size:"small",onClick:()=>b("added"),children:"×"}):null}),e.jsx("div",{className:"flex justify-center",children:e.jsx(D,{onClick:()=>B("added"),className:"custom-button w-auto text-xs",type:"default",size:"small",icon:e.jsx(W,{}),children:e.jsx("span",{className:"text-xs",children:"Reset"})})})]}),e.jsx("div",{className:"w-auto overflow-x-auto",children:e.jsx(X,{rowKey:"id",dataSource:m.added?p.added.slice((i.added-1)*o.added,i.added*o.added):A.slice((i.added-1)*o.added,i.added*o.added),columns:te(F,"Added",r.added),bordered:!0,pagination:!1,onChange:(t,x,I)=>H("added",t,x,I),scroll:{x:"max-content",y:620},loading:n,responsive:["sm","md","lg","xl","xxl"],expandable:f?{expandedRowRender:t=>e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",t.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Action:"})," ",t.action]}),e.jsxs("div",{children:[e.jsx("b",{children:"Action Date:"})," ",t.action_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Item ID:"})," ",t.item_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",t.type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Brand:"})," ",t.brand]}),e.jsxs("div",{children:[e.jsx("b",{children:"Quantity:"})," ",t.quantity]}),e.jsxs("div",{children:[e.jsx("b",{children:"Remarks:"})," ",t.remarks]}),e.jsxs("div",{children:[e.jsx("b",{children:"Serial Number:"})," ",t.serial_number]}),e.jsxs("div",{children:[e.jsx("b",{children:"Issued Date:"})," ",t.issued_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Purchased Date:"})," ",t.purchase_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Condition:"})," ",t.condition]}),e.jsxs("div",{children:[e.jsx("b",{children:"Location:"})," ",t.location]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",t.status]})]}),rowExpandable:()=>!0}:void 0})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between mt-5 space-y-2 sm:space-y-0",children:[e.jsxs(Z.Text,{className:"w-full text-xs text-nowrap text-center sm:text-left overflow-auto",style:{color:"#072C1C"},children:["Showing ",(m.added?p.added:A).length>0?(i.added-1)*o.added+1:0," to"," ",Math.min(i.added*o.added,(m.added?p.added:A).length)," ","of ",(m.added?p.added:A).length," entries"]}),e.jsx("div",{className:"w-full flex justify-center sm:justify-end",children:e.jsx(ee,{current:i.added,pageSize:o.added,total:(m.added?p.added:A).length,showSizeChanger:!0,pageSizeOptions:["10","20","30","50","100","200","500","1000","2000"],onChange:(t,x)=>O("added",t,x),responsive:["sm","md","lg","xl","xxl"],className:"text-xs"})})]})]})},{key:"2",label:"Updated / QRCode Update",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-4",children:[e.jsx(U,{menu:M("updated"),trigger:["click"],children:e.jsx(D,{type:"text",className:"border-black bg-[#a7f3d0] text-xs w-auto sm:block hidden",icon:e.jsx(G,{}),children:e.jsxs(V,{children:[((P=k.find(t=>t.key===h.updated))==null?void 0:P.label)||"All Columns",e.jsx(K,{className:"text-xs"})]})})}),e.jsx(Y,{placeholder:`Search in ${h.updated==="all"?"all columns":(T=k.find(t=>t.key===h.updated))==null?void 0:T.label}`,prefix:e.jsx(J,{style:{color:"black"}}),value:r.updated,onChange:t=>L("updated",t),className:"border border-black w-auto ml-1 text-xs",suffix:r.updated?e.jsx(D,{type:"text",size:"small",onClick:()=>b("updated"),children:"×"}):null}),e.jsx("div",{className:"flex justify-center",children:e.jsx(D,{onClick:()=>B("updated"),className:"custom-button w-auto text-xs ",type:"default",size:"small",icon:e.jsx(W,{}),children:e.jsx("span",{className:"text-xs",children:"Reset"})})})]}),e.jsx("div",{className:"w-auto overflow-x-auto",children:e.jsx(X,{rowKey:"id",dataSource:m.updated?p.updated.slice((i.updated-1)*o.updated,i.updated*o.updated):R.slice((i.updated-1)*o.updated,i.updated*o.updated),columns:te(F,"Updated",r.updated),bordered:!0,pagination:!1,onChange:(t,x,I)=>H("updated",t,x,I),scroll:{x:"max-content",y:620},loading:n,expandable:f?{expandedRowRender:t=>e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",t.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Action:"})," ",t.action]}),e.jsxs("div",{children:[e.jsx("b",{children:"Action Date:"})," ",t.action_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Item ID:"})," ",t.item_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Field Changed:"})," ",Array.isArray(t.field_changed)?t.field_changed.join(", "):typeof t.field_changed=="string"?t.field_changed.split(/[,|;]/).map(x=>x.trim()).filter(Boolean).join(", "):""]})]}),rowExpandable:()=>!0}:void 0})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-center sm:justify-between mt-5 space-y-2 sm:space-y-0",children:[e.jsxs(Z.Text,{className:"w-full text-xs text-nowrap text-center sm:text-left",style:{color:"#072C1C"},children:["Showing ",(m.updated?p.updated:R).length>0?(i.updated-1)*o.updated+1:0," to"," ",Math.min(i.updated*o.updated,(m.updated?p.updated:R).length)," "," of ",(m.updated?p.updated:R).length," entries"]}),e.jsx("div",{className:"w-full flex justify-center sm:justify-end",children:e.jsx(ee,{current:i.updated,pageSize:o.updated,total:(m.updated?p.updated:R).length,showSizeChanger:!0,pageSizeOptions:["10","20","30","50","100","200","500","1000","2000"],onChange:(t,x)=>O("updated",t,x),className:"text-xs",responsive:!0})})]})]})},{key:"3",label:"Deleted",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-4",children:[e.jsx(U,{menu:M("deleted"),trigger:["click"],children:e.jsx(D,{type:"text",className:"bg-[#a7f3d0] border-black w-auto text-xs sm:block hidden",icon:e.jsx(G,{}),children:e.jsxs(V,{children:[((q=k.find(t=>t.key===h.deleted))==null?void 0:q.label)||"All Columns",e.jsx(K,{})]})})}),e.jsx(Y,{placeholder:`Search in ${h.deleted==="all"?"all columns":($=k.find(t=>t.key===h.deleted))==null?void 0:$.label}`,prefix:e.jsx(J,{style:{color:"black"}}),value:r.deleted,onChange:t=>L("deleted",t),className:"border border-black w-auto ml-1 text-xs",suffix:r.deleted?e.jsx(D,{type:"text",size:"small",onClick:()=>b("deleted"),children:"×"}):null}),e.jsx("div",{className:"flex justify-center",children:e.jsx(D,{onClick:()=>B("deleted"),className:"custom-button w-auto text-xs",type:"default",size:"small",icon:e.jsx(W,{}),children:e.jsx("span",{className:"text-xs",children:"Reset"})})})]}),e.jsx("div",{className:"w-auto overflow-x-auto",children:e.jsx(X,{rowKey:"id",dataSource:m.deleted?p.deleted.slice((i.deleted-1)*o.deleted,i.deleted*o.deleted):y.slice((i.deleted-1)*o.deleted,i.deleted*o.deleted),columns:te(F,"Deleted",r.deleted),bordered:!0,pagination:!1,onChange:(t,x,I)=>H("deleted",t,x,I),scroll:{x:"max-content",y:620},loading:n,className:"text-xs overflow-auto",expandable:f?{expandedRowRender:t=>e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("b",{children:"ID:"})," ",t.id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Action:"})," ",t.action]}),e.jsxs("div",{children:[e.jsx("b",{children:"Action Date:"})," ",t.action_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Item ID:"})," ",t.item_id]}),e.jsxs("div",{children:[e.jsx("b",{children:"Type:"})," ",t.type]}),e.jsxs("div",{children:[e.jsx("b",{children:"Brand:"})," ",t.brand]}),e.jsxs("div",{children:[e.jsx("b",{children:"Qty:"})," ",t.quantity]}),e.jsxs("div",{children:[e.jsx("b",{children:"Remarks:"})," ",t.quantity]}),e.jsxs("div",{children:[e.jsx("b",{children:"Serial Number:"})," ",t.serial_number]}),e.jsxs("div",{children:[e.jsx("b",{children:"Issued Date:"})," ",t.issued_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Purchased Date:"})," ",t.purchase_date]}),e.jsxs("div",{children:[e.jsx("b",{children:"Condition:"})," ",t.condition]}),e.jsxs("div",{children:[e.jsx("b",{children:"Detachment/Office:"})," ",t.location]}),e.jsxs("div",{children:[e.jsx("b",{children:"Status:"})," ",t.status]})]})}:void 0})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-center sm:justify-between mt-5 space-y-2 sm:space-y-0",children:[e.jsxs(Z.Text,{className:"w-full text-xs text-nowrap text-center sm:text-left",style:{color:"#072C1C"},children:["Showing ",(m.deleted?p.deleted:y).length>0?(i.deleted-1)*o.deleted+1:0," to"," ",Math.min(i.deleted*o.deleted,(m.deleted?p.deleted:y).length)," "," of ",(m.deleted?p.deleted:y).length," entries"]}),e.jsx("div",{className:"w-full flex justify-center sm:justify-end",children:e.jsx(ee,{current:i.deleted,pageSize:o.deleted,total:(m.deleted?p.deleted:y).length,showSizeChanger:!0,pageSizeOptions:["10","20","30","50","100","200","500","1000","2000"],onChange:(t,x)=>O("deleted",t,x),className:"text-xs",responsive:!0})})]})]})}]}),e.jsx(xe,{visible:l,onClose:()=>S(!1),record:d})]})},be=()=>e.jsx("div",{className:"container max-w-full",children:e.jsx("div",{className:"mt-5",children:e.jsx(pe,{})})});export{be as default};
